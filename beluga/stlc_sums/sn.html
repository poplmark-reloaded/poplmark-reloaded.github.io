<html>
<head>
	<meta charset="UTF-8">
	<style type="text/css">
		body {
			padding: 2em 1em 2em 1em;
			margin: 0;
			font-family: sans-serif;
			color: black;
			background: white;}
		a{text-decoration:none;}
		a:link { color: #00C; background: transparent }
		a:visited { color: #00C; background: transparent }
		a:active { color: #C00; background: transparent }
		keyword { color: #3333cc ; background: transparent }
		pre {
			border: 1px dashed maroon;  display:block;
			padding:8px; background-color: #dddddd;}
		code {
			background-color: #dddddd;
			color: black; font-family: "courier";margin:0;
			white-space: pre-wrap; }
		.typ {color: #660000; font-weight:bold}
		.constructor {color: #335C85; font-weight:bold}
		.function {color: #660033; font-weight:bold}
		.schema {color: #6600CC; font-weight:bold}
	</style>
</head>
<body>
<br><pre><code><keyword>LF</keyword> <span class="typ" id="ty">ty</span> : <keyword>type</keyword> = 
| <span class="constructor" id="base">base</span> : <a href="#ty">ty</a>
| <span class="constructor" id="arr">arr</span> : <a href="#ty">ty</a> &#x2192 <a href="#ty">ty</a> &#x2192 <a href="#ty">ty</a>
| <span class="constructor" id="sum">sum</span> : <a href="#ty">ty</a> &#x2192 <a href="#ty">ty</a> &#x2192 <a href="#ty">ty</a>;
<br><keyword>LF</keyword> <span class="typ" id="tm">tm</span> : <a href="#ty">ty</a> &#x2192 <keyword>type</keyword> = 
| <span class="constructor" id="abs">abs</span> : (<a href="#tm">tm</a> A &#x2192 <a href="#tm">tm</a> B) &#x2192 <a href="#tm">tm</a> (<a href="#arr">arr</a> A B)
| <span class="constructor" id="app">app</span> : <a href="#tm">tm</a> (<a href="#arr">arr</a> A B) &#x2192 <a href="#tm">tm</a> A &#x2192 <a href="#tm">tm</a> B
| <span class="constructor" id="inl">inl</span> : {B : <a href="#ty">ty</a>} (<a href="#tm">tm</a> A &#x2192 <a href="#tm">tm</a> (<a href="#sum">sum</a> A B))
| <span class="constructor" id="inr">inr</span> : {A : <a href="#ty">ty</a>} (<a href="#tm">tm</a> B &#x2192 <a href="#tm">tm</a> (<a href="#sum">sum</a> A B))
| <span class="constructor" id="match">match</span> : <a href="#tm">tm</a> (<a href="#sum">sum</a> A B) &#x2192 (<a href="#tm">tm</a> A &#x2192 <a href="#tm">tm</a> C) &#x2192 (<a href="#tm">tm</a> B &#x2192 <a href="#tm">tm</a> C) &#x2192 <a href="#tm">tm</a> C;
<br><keyword>schema</keyword> <span class="schema" id="cxt">cxt</span> = <a href="#tm">tm</a> A;
<br><keyword>LF</keyword> <span class="typ" id="step">step</span> : <a href="#tm">tm</a> A &#x2192 <a href="#tm">tm</a> A &#x2192 <keyword>type</keyword> = 
| <span class="constructor" id="rbeta">rbeta</span> : <a href="#step">step</a> (<a href="#app">app</a> (<a href="#abs">abs</a> M) N) (M N)
| <span class="constructor" id="rabs">rabs</span> : ({x : <a href="#tm">tm</a> A} (<a href="#step">step</a> (M x) (M' x))) &#x2192 <a href="#step">step</a> (<a href="#abs">abs</a> M) (<a href="#abs">abs</a> M')
| <span class="constructor" id="rappl">rappl</span> : <a href="#step">step</a> M M' &#x2192 <a href="#step">step</a> (<a href="#app">app</a> M N) (<a href="#app">app</a> M' N)
| <span class="constructor" id="rappr">rappr</span> : <a href="#step">step</a> N N' &#x2192 <a href="#step">step</a> (<a href="#app">app</a> M N) (<a href="#app">app</a> M N')
| <span class="constructor" id="rinl">rinl</span> : <a href="#step">step</a> M N &#x2192 <a href="#step">step</a> (<a href="#inl">inl</a> B M) (<a href="#inl">inl</a> B N)
| <span class="constructor" id="rinr">rinr</span> : <a href="#step">step</a> M N &#x2192 <a href="#step">step</a> (<a href="#inr">inr</a> A M) (<a href="#inr">inr</a> A N)
| <span class="constructor" id="rcase">rcase</span> : <a href="#step">step</a> M M' &#x2192 <a href="#step">step</a> (<a href="#match">match</a> M N1 N2) (<a href="#match">match</a> M' N1 N2)
| <span class="constructor" id="rcinl">rcinl</span> : <a href="#step">step</a> (<a href="#match">match</a> (<a href="#inl">inl</a> B M) N1 N2) (N1 M)
| <span class="constructor" id="rcinr">rcinr</span> : <a href="#step">step</a> (<a href="#match">match</a> (<a href="#inr">inr</a> A M) N1 N2) (N2 M)
| <span class="constructor" id="rcl">rcl</span> : ({x : <a href="#tm">tm</a> A} (<a href="#step">step</a> (N x) (N' x))) &#x2192 <a href="#step">step</a> (<a href="#match">match</a> M N N2) (<a href="#match">match</a> M N' N2)
| <span class="constructor" id="rcr">rcr</span> : ({x : <a href="#tm">tm</a> B} (<a href="#step">step</a> (N x) (N' x))) &#x2192 <a href="#step">step</a> (<a href="#match">match</a> M N1 N) (<a href="#match">match</a> M N1 N');
<br><keyword>LF</keyword> <span class="typ" id="mstep">mstep</span> : <a href="#tm">tm</a> A &#x2192 <a href="#tm">tm</a> A &#x2192 <keyword>type</keyword> = 
| <span class="constructor" id="m-refl">m-refl</span> : <a href="#mstep">mstep</a> M M
| <span class="constructor" id="m-step">m-step</span> : <a href="#step">step</a> M N &#x2192 <a href="#mstep">mstep</a> N M' &#x2192 <a href="#mstep">mstep</a> M M';
<br><keyword>rec</keyword> <span class="function" id="m-trans">m-trans</span> : (g:<a href="#cxt">cxt</a>) {M1 : [g &#x22A2 <a href="#tm">tm</a> A[]]} [g &#x22A2 <a href="#mstep">mstep</a> M1 M] &#x2192 [g &#x22A2 <a href="#mstep">mstep</a> M M2] &#x2192 [g &#x22A2 <a href="#mstep">mstep</a> M1 M2] / total s1 ( m-trans g a m1 m2 m s1 ) / =
<keyword>mlam</keyword> M1 &#x21D2 <keyword>fn</keyword> s1 &#x21D2 <keyword>fn</keyword> s2 &#x21D2 <keyword>case</keyword> s1 <keyword>of</keyword> 
  | [g &#x22A2 <a href="#m-refl">m-refl</a>] &#x21D2 s2
  | [g &#x22A2 <a href="#m-step">m-step</a> S MS] &#x21D2
    <keyword>let</keyword>  [g &#x22A2 MS'] = <a href="#m-trans">m-trans</a> [g &#x22A2 _] [g &#x22A2 MS] s2 <keyword>in</keyword> [g &#x22A2 <a href="#m-step">m-step</a> S MS'];
<br><keyword>rec</keyword> <span class="function" id="mstep_appl">mstep_appl</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#arr">arr</a> A[] B[])]} {M' : [g &#x22A2 <a href="#tm">tm</a> (<a href="#arr">arr</a> A[] B[])]} {N : [g &#x22A2 <a href="#tm">tm</a> A[]]} [g &#x22A2 <a href="#mstep">mstep</a> M M'] &#x2192 [g &#x22A2 <a href="#mstep">mstep</a> (<a href="#app">app</a> M N) (<a href="#app">app</a> M' N)] / total ms ( mstep_appl g a b m m' n ms ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> M' &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>fn</keyword> ms &#x21D2 <keyword>case</keyword> ms <keyword>of</keyword> 
  | [g &#x22A2 <a href="#m-refl">m-refl</a>] &#x21D2 [g &#x22A2 <a href="#m-refl">m-refl</a>]
  | [g &#x22A2 <a href="#m-step">m-step</a> S MS'] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 MS''] = <a href="#mstep_appl">mstep_appl</a> [_ &#x22A2 _] [_ &#x22A2 M'] [_ &#x22A2 N] [_ &#x22A2 MS'] <keyword>in</keyword> [g &#x22A2 <a href="#m-step">m-step</a> (<a href="#rappl">rappl</a> S) MS''];
<br><keyword>rec</keyword> <span class="function" id="mstep_appr">mstep_appr</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#arr">arr</a> A[] B[])]} {N : [g &#x22A2 <a href="#tm">tm</a> A[]]} {N' : [g &#x22A2 <a href="#tm">tm</a> A[]]} [g &#x22A2 <a href="#mstep">mstep</a> N N'] &#x2192 [g &#x22A2 <a href="#mstep">mstep</a> (<a href="#app">app</a> M N) (<a href="#app">app</a> M N')] / total ms ( mstep_appr g a b m n n' ms ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>mlam</keyword> N' &#x21D2 <keyword>fn</keyword> ms &#x21D2 <keyword>case</keyword> ms <keyword>of</keyword> 
  | [g &#x22A2 <a href="#m-refl">m-refl</a>] &#x21D2 [g &#x22A2 <a href="#m-refl">m-refl</a>]
  | [g &#x22A2 <a href="#m-step">m-step</a> S MS'] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 MS''] = <a href="#mstep_appr">mstep_appr</a> [_ &#x22A2 M] [_ &#x22A2 _] [_ &#x22A2 N'] [_ &#x22A2 MS'] <keyword>in</keyword> [g &#x22A2 <a href="#m-step">m-step</a> (<a href="#rappr">rappr</a> S) MS''];
<br><keyword>rec</keyword> <span class="function" id="mstep_abs">mstep_abs</span> : (g:<a href="#cxt">cxt</a>) {M : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> B[]]} [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#mstep">mstep</a> M M'] &#x2192 [g &#x22A2 <a href="#mstep">mstep</a> (<a href="#abs">abs</a> (&lambda;x. M)) (<a href="#abs">abs</a> (&lambda;x. M'))] / total ms ( mstep_abs g a b m m' ms ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>fn</keyword> s1 &#x21D2 <keyword>case</keyword> s1 <keyword>of</keyword> 
  | [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#m-refl">m-refl</a>] &#x21D2 [g &#x22A2 <a href="#m-refl">m-refl</a>]
  | [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#m-step">m-step</a> S MS] &#x21D2
    <keyword>let</keyword>  [g &#x22A2 MS'] = <a href="#mstep_abs">mstep_abs</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 _] [g, x : <a href="#tm">tm</a> A[] &#x22A2 MS] <keyword>in</keyword> 
    <keyword>let</keyword>  [g &#x22A2 S'] = [g &#x22A2 <a href="#rabs">rabs</a> (&lambda;x. S)] <keyword>in</keyword> [g &#x22A2 <a href="#m-step">m-step</a> S' MS'];
<br><keyword>rec</keyword> <span class="function" id="mstep_inl">mstep_inl</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} {M' : [g &#x22A2 <a href="#tm">tm</a> A[]]} {B : [ &#x22A2 <a href="#ty">ty</a>]} [g &#x22A2 <a href="#mstep">mstep</a> M M'] &#x2192 [g &#x22A2 <a href="#mstep">mstep</a> (<a href="#inl">inl</a> B[] M) (<a href="#inl">inl</a> B[] M')] / total ms ( mstep_inl g a m m' b ms ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> M' &#x21D2 <keyword>mlam</keyword> B &#x21D2 <keyword>fn</keyword> ms &#x21D2 <keyword>case</keyword> ms <keyword>of</keyword> 
  | [g &#x22A2 <a href="#m-refl">m-refl</a>] &#x21D2 [g &#x22A2 <a href="#m-refl">m-refl</a>]
  | [g &#x22A2 <a href="#m-step">m-step</a> S MS'] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 MS''] = <a href="#mstep_inl">mstep_inl</a> [_ &#x22A2 _] [_ &#x22A2 _] [ &#x22A2 B] [_ &#x22A2 MS'] <keyword>in</keyword> [g &#x22A2 <a href="#m-step">m-step</a> (<a href="#rinl">rinl</a> S) MS''];
<br><keyword>rec</keyword> <span class="function" id="mstep_inr">mstep_inr</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} {M' : [g &#x22A2 <a href="#tm">tm</a> A[]]} {B : [ &#x22A2 <a href="#ty">ty</a>]} [g &#x22A2 <a href="#mstep">mstep</a> M M'] &#x2192 [g &#x22A2 <a href="#mstep">mstep</a> (<a href="#inr">inr</a> B[] M) (<a href="#inr">inr</a> B[] M')] / total ms ( mstep_inr g a m m' b ms ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> M' &#x21D2 <keyword>mlam</keyword> B &#x21D2 <keyword>fn</keyword> ms &#x21D2 <keyword>case</keyword> ms <keyword>of</keyword> 
  | [g &#x22A2 <a href="#m-refl">m-refl</a>] &#x21D2 [g &#x22A2 <a href="#m-refl">m-refl</a>]
  | [g &#x22A2 <a href="#m-step">m-step</a> S MS] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 MS'] = <a href="#mstep_inr">mstep_inr</a> [_ &#x22A2 _] [_ &#x22A2 _] [ &#x22A2 B] [_ &#x22A2 MS] <keyword>in</keyword> [g &#x22A2 <a href="#m-step">m-step</a> (<a href="#rinr">rinr</a> S) MS'];
<br><keyword>rec</keyword> <span class="function" id="mstep_match">mstep_match</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} {M' : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} {N1 : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {N2 : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} [g &#x22A2 <a href="#mstep">mstep</a> M M'] &#x2192 [g &#x22A2 <a href="#mstep">mstep</a> (<a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)) (<a href="#match">match</a> M' (&lambda;x. N1) (&lambda;y. N2))] / total ms ( mstep_match g a b c m m' n1 n2 ms ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> M' &#x21D2 <keyword>mlam</keyword> N1 &#x21D2 <keyword>mlam</keyword> N2 &#x21D2 <keyword>fn</keyword> ms &#x21D2 <keyword>case</keyword> ms <keyword>of</keyword> 
  | [g &#x22A2 <a href="#m-refl">m-refl</a>] &#x21D2 [g &#x22A2 <a href="#m-refl">m-refl</a>]
  | [g &#x22A2 <a href="#m-step">m-step</a> S MS] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 MS'] = <a href="#mstep_match">mstep_match</a> [_ &#x22A2 _] [_ &#x22A2 M'] [_ &#x22A2 N1] [_ &#x22A2 N2] [_ &#x22A2 MS] <keyword>in</keyword> [g &#x22A2 <a href="#m-step">m-step</a> (<a href="#rcase">rcase</a> S) MS'];
<br><keyword>rec</keyword> <span class="function" id="mstep_matchl">mstep_matchl</span> : (g:<a href="#cxt">cxt</a>) {N : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {N' : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} {N2 : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#mstep">mstep</a> N N'] &#x2192 [g &#x22A2 <a href="#mstep">mstep</a> (<a href="#match">match</a> M (&lambda;x. N) (&lambda;y. N2)) (<a href="#match">match</a> M (&lambda;x. N') (&lambda;y. N2))] / total ms ( mstep_matchl g a c b n n' m n2 ms ) / =
<keyword>mlam</keyword> N &#x21D2 <keyword>mlam</keyword> N' &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N2 &#x21D2 <keyword>fn</keyword> ms &#x21D2 <keyword>case</keyword> ms <keyword>of</keyword> 
  | [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#m-refl">m-refl</a>] &#x21D2 [g &#x22A2 <a href="#m-refl">m-refl</a>]
  | [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#m-step">m-step</a> S MS] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 MS'] = <a href="#mstep_matchl">mstep_matchl</a> [_ &#x22A2 _] [_ &#x22A2 N'] [_ &#x22A2 M] [_ &#x22A2 N2] [_ &#x22A2 MS] <keyword>in</keyword> [g &#x22A2 <a href="#m-step">m-step</a> (<a href="#rcl">rcl</a> (&lambda;x. S)) MS'];
<br><keyword>rec</keyword> <span class="function" id="mstep_matchr">mstep_matchr</span> : (g:<a href="#cxt">cxt</a>) {N : [g, x : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} {N' : [g, x : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} {N1 : [g, y : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} [g, x : <a href="#tm">tm</a> B[] &#x22A2 <a href="#mstep">mstep</a> N N'] &#x2192 [g &#x22A2 <a href="#mstep">mstep</a> (<a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N)) (<a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N'))] / total ms ( mstep_matchr g b c a n n' m n1 ms ) / =
<keyword>mlam</keyword> N &#x21D2 <keyword>mlam</keyword> N' &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N1 &#x21D2 <keyword>fn</keyword> ms &#x21D2 <keyword>case</keyword> ms <keyword>of</keyword> 
  | [g, x : <a href="#tm">tm</a> B[] &#x22A2 <a href="#m-refl">m-refl</a>] &#x21D2 [g &#x22A2 <a href="#m-refl">m-refl</a>]
  | [g, x : <a href="#tm">tm</a> B[] &#x22A2 <a href="#m-step">m-step</a> S MS] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 MS'] = <a href="#mstep_matchr">mstep_matchr</a> [_ &#x22A2 _] [_ &#x22A2 N'] [_ &#x22A2 M] [_ &#x22A2 N1] [_ &#x22A2 MS] <keyword>in</keyword> [g &#x22A2 <a href="#m-step">m-step</a> (<a href="#rcr">rcr</a> (&lambda;x. S)) MS'];
<br><keyword>rec</keyword> <span class="function" id="subst_mred">subst_mred</span> : (g:<a href="#cxt">cxt</a>) {M : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> B[]]} {N : [g &#x22A2 <a href="#tm">tm</a> A[]]} {N' : [g &#x22A2 <a href="#tm">tm</a> A[]]} [g &#x22A2 <a href="#step">step</a> N N'] &#x2192 [g &#x22A2 <a href="#mstep">mstep</a> M[&hellip;, N] M[&hellip;, N']] / trust / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>mlam</keyword> N' &#x21D2 <keyword>fn</keyword> s &#x21D2 <keyword>case</keyword> [_, x : <a href="#tm">tm</a> _ &#x22A2 M] <keyword>of</keyword> 
  | [g, x : <a href="#tm">tm</a> A[] &#x22A2 x] &#x21D2 <keyword>let</keyword>  [g &#x22A2 S] = s <keyword>in</keyword> [g &#x22A2 <a href="#m-step">m-step</a> S <a href="#m-refl">m-refl</a>]
  | [g, x : <a href="#tm">tm</a> A[] &#x22A2 #p[&hellip;]] &#x21D2 [g &#x22A2 <a href="#m-refl">m-refl</a>]
  | [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#abs">abs</a> (&lambda;y. M)] &#x21D2
    <keyword>let</keyword>  [g &#x22A2 S] = s <keyword>in</keyword> <keyword>let</keyword>  [g, y : <a href="#tm">tm</a> _ &#x22A2 S'] =
                                                                    <a href="#subst_mred">subst_mred</a> [g, y : <a href="#tm">tm</a> _, x : <a href="#tm">tm</a> A[] &#x22A2 M[&hellip;, x, y]] [g, y : <a href="#tm">tm</a> _ &#x22A2 N[&hellip;]] [g, y : <a href="#tm">tm</a> _ &#x22A2 N'[&hellip;]] [g, y : <a href="#tm">tm</a> _ &#x22A2 S[&hellip;]] <keyword>in</keyword>
                                                                    <a href="#mstep_abs">mstep_abs</a> [g, y : <a href="#tm">tm</a> _ &#x22A2 _] [g, y : <a href="#tm">tm</a> _ &#x22A2 S']
  | [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#app">app</a> M1 M2] &#x21D2
    <keyword>let</keyword>  [g &#x22A2 S1] = <a href="#subst_mred">subst_mred</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 M1] [g &#x22A2 N] [g &#x22A2 N'] s <keyword>in</keyword> 
    <keyword>let</keyword>  [g &#x22A2 S2] = <a href="#subst_mred">subst_mred</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 M2] [g &#x22A2 N] [g &#x22A2 N'] s <keyword>in</keyword> 
    <keyword>let</keyword>  [g &#x22A2 MS1] =
    <a href="#mstep_appl">mstep_appl</a> [g &#x22A2 M1[&hellip;, N]] [g &#x22A2 M1[&hellip;, N']] [g &#x22A2 M2[&hellip;, N]] [g &#x22A2 S1] <keyword>in</keyword> 
    <keyword>let</keyword>  [g &#x22A2 MS2] =
    <a href="#mstep_appr">mstep_appr</a> [g &#x22A2 M1[&hellip;, N']] [g &#x22A2 M2[&hellip;, N]] [g &#x22A2 M2[&hellip;, N']] [g &#x22A2 S2] <keyword>in</keyword> <a href="#m-trans">m-trans</a> [g &#x22A2 _] [g &#x22A2 MS1] [g &#x22A2 MS2]
  | [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#inl">inl</a> B[] M] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 MS] = <a href="#subst_mred">subst_mred</a> [_ &#x22A2 M] [_ &#x22A2 N] [_ &#x22A2 N'] s <keyword>in</keyword> <a href="#mstep_inl">mstep_inl</a> [g &#x22A2 M[&hellip;, N]] [g &#x22A2 M[&hellip;, N']] [ &#x22A2 B] [_ &#x22A2 MS]
  | [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#inr">inr</a> B[] M] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 MS] = <a href="#subst_mred">subst_mred</a> [_ &#x22A2 M] [_ &#x22A2 N] [_ &#x22A2 N'] s <keyword>in</keyword> <a href="#mstep_inr">mstep_inr</a> [_ &#x22A2 _] [_ &#x22A2 _] [ &#x22A2 B] [_ &#x22A2 MS]
  | [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 S] = s <keyword>in</keyword> <keyword>let</keyword>  [_ &#x22A2 S0] =
                                                                    <a href="#subst_mred">subst_mred</a> [_ &#x22A2 M] [_ &#x22A2 N] [_ &#x22A2 N'] s <keyword>in</keyword> 
    <keyword>let</keyword>  [g, y : <a href="#tm">tm</a> B[] &#x22A2 S1] =
    <a href="#subst_mred">subst_mred</a> [g, y : <a href="#tm">tm</a> _, x : <a href="#tm">tm</a> A[] &#x22A2 N1[&hellip;, x, y]] [g, y : <a href="#tm">tm</a> _ &#x22A2 N[&hellip;]] [g, y : <a href="#tm">tm</a> _ &#x22A2 N'[&hellip;]] [g, y : <a href="#tm">tm</a> _ &#x22A2 S[&hellip;]] <keyword>in</keyword>
    <keyword>let</keyword>  [g, y : <a href="#tm">tm</a> C[] &#x22A2 S2] =
    <a href="#subst_mred">subst_mred</a> [g, y : <a href="#tm">tm</a> _, x : <a href="#tm">tm</a> A[] &#x22A2 N2[&hellip;, x, y]] [g, y : <a href="#tm">tm</a> _ &#x22A2 N[&hellip;]] [g, y : <a href="#tm">tm</a> _ &#x22A2 N'[&hellip;]] [g, y : <a href="#tm">tm</a> _ &#x22A2 S[&hellip;]] <keyword>in</keyword>
    <keyword>let</keyword>  [g, x : <a href="#tm">tm</a> A[], y : <a href="#tm">tm</a> B[] &#x22A2 N1'] = [_ &#x22A2 N1] <keyword>in</keyword> 
    <keyword>let</keyword>  [g &#x22A2 MS0] =
    <a href="#mstep_match">mstep_match</a> [g &#x22A2 M[&hellip;, N]] [g &#x22A2 M[&hellip;, N']] [g, y : <a href="#tm">tm</a> B[] &#x22A2 N1[&hellip;, N[&hellip;], y]] [g, y : <a href="#tm">tm</a> C[] &#x22A2 N2[&hellip;, N[&hellip;], y]] [_ &#x22A2 S0] <keyword>in</keyword>
    <keyword>let</keyword>  [g &#x22A2 MS1] =
    <a href="#mstep_matchl">mstep_matchl</a> [g, y : <a href="#tm">tm</a> B[] &#x22A2 N1[&hellip;, N[&hellip;], y]] [g, y : <a href="#tm">tm</a> B[] &#x22A2 N1[&hellip;, N'[&hellip;], y]] [g &#x22A2 M[&hellip;, N']] [g, y : <a href="#tm">tm</a> C[] &#x22A2 N2[&hellip;, N[&hellip;], y]] [_ &#x22A2 S1] <keyword>in</keyword>
    <keyword>let</keyword>  [g &#x22A2 MS2] =
    <a href="#mstep_matchr">mstep_matchr</a> [g, y : <a href="#tm">tm</a> C[] &#x22A2 N2[&hellip;, N[&hellip;], y]] [g, y : <a href="#tm">tm</a> C[] &#x22A2 N2[&hellip;, N'[&hellip;], y]] [g &#x22A2 M[&hellip;, N']] [g, y : <a href="#tm">tm</a> B[] &#x22A2 N1[&hellip;, N'[&hellip;], y]] [_ &#x22A2 S2] <keyword>in</keyword>
    <a href="#m-trans">m-trans</a> [_ &#x22A2 _] [_ &#x22A2 MS0] (<a href="#m-trans">m-trans</a> [_ &#x22A2 _] [_ &#x22A2 MS1] [_ &#x22A2 MS2]);
<br><keyword>inductive</keyword> <span class="typ" id="Sn">Sn</span> : {g : <a href="#cxt">cxt</a>} &#x2192 {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 <keyword>ctype</keyword> = 
| <span class="constructor" id="Acc">Acc</span> : {g : <a href="#cxt">cxt</a>} {A : [ &#x22A2 <a href="#ty">ty</a>]} {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} ({M' : [g &#x22A2 <a href="#tm">tm</a> A[]]} {S : [g &#x22A2 <a href="#step">step</a> M M']} <a href="&sigma;n">Sn</a> [g &#x22A2 M']) &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 M];
<br><keyword>rec</keyword> <span class="function" id="mstep_sn">mstep_sn</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} {M' : [g &#x22A2 <a href="#tm">tm</a> A[]]} [g &#x22A2 <a href="#mstep">mstep</a> M M'] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 M] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 M'] / total sn ( mstep_sn g m m' ms sn ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> M' &#x21D2 <keyword>fn</keyword> ms &#x21D2 <keyword>fn</keyword> sn &#x21D2 <keyword>case</keyword> ms <keyword>of</keyword> 
  | [g &#x22A2 <a href="#m-refl">m-refl</a>] &#x21D2 sn
  | [g &#x22A2 <a href="#m-step">m-step</a> S MS'] &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 A]) ([g &#x22A2 _]) r = sn <keyword>in</keyword> 
    <keyword>let</keyword> sn' = r [_ &#x22A2 _] [_ &#x22A2 S] <keyword>in</keyword> <a href="#mstep_sn">mstep_sn</a> [_ &#x22A2 _] [_ &#x22A2 M'] [_ &#x22A2 MS'] sn';
<br><keyword>inductive</keyword> <span class="typ" id="SN">SN</span> : {g : <a href="#cxt">cxt</a>} &#x2192 {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 <keyword>ctype</keyword> = 
| <span class="constructor" id="SNeu">SNeu</span> : <a href="&sigma;Ne">SNe</a> [g &#x22A2 R] &#x2192 <a href="&sigma;N">SN</a> [g &#x22A2 R]
| <span class="constructor" id="SAbs">SAbs</span> : <a href="&sigma;N">SN</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 M] &#x2192 <a href="&sigma;N">SN</a> [g &#x22A2 <a href="#abs">abs</a> (&lambda;x. M)]
| <span class="constructor" id="SRed">SRed</span> : <a href="&sigma;NRed">SNRed</a> [g &#x22A2 M] [g &#x22A2 M'] &#x2192 <a href="&sigma;N">SN</a> [g &#x22A2 M'] &#x2192 <a href="&sigma;N">SN</a> [g &#x22A2 M]
| <span class="constructor" id="SInl">SInl</span> : <a href="&sigma;N">SN</a> [g &#x22A2 M] &#x2192 <a href="&sigma;N">SN</a> [g &#x22A2 <a href="#inl">inl</a> _ M]
| <span class="constructor" id="SInr">SInr</span> : <a href="&sigma;N">SN</a> [g &#x22A2 M] &#x2192 <a href="&sigma;N">SN</a> [g &#x22A2 <a href="#inr">inr</a> _ M]
<keyword>and</keyword> <keyword>inductive</keyword> <span class="typ" id="SNe">SNe</span> : {g : <a href="#cxt">cxt</a>} &#x2192 {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 <keyword>ctype</keyword> = 
| <span class="constructor" id="SVar">SVar</span> : {#p : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;Ne">SNe</a> [g &#x22A2 #p]
| <span class="constructor" id="SApp">SApp</span> : <a href="&sigma;Ne">SNe</a> [g &#x22A2 R] &#x2192 <a href="&sigma;N">SN</a> [g &#x22A2 M] &#x2192 <a href="&sigma;Ne">SNe</a> [g &#x22A2 <a href="#app">app</a> R M]
| <span class="constructor" id="SCase">SCase</span> : <a href="&sigma;Ne">SNe</a> [g &#x22A2 M] &#x2192 <a href="&sigma;N">SN</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 N1] &#x2192 <a href="&sigma;N">SN</a> [g, y : <a href="#tm">tm</a> B[] &#x22A2 N2] &#x2192 <a href="&sigma;Ne">SNe</a> [g &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)]
<keyword>and</keyword> <keyword>inductive</keyword> <span class="typ" id="SNRed">SNRed</span> : {g : <a href="#cxt">cxt</a>} &#x2192 {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 {M' : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 <keyword>ctype</keyword> = 
| <span class="constructor" id="SBeta">SBeta</span> : {M : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> B[]]} <a href="&sigma;N">SN</a> [g &#x22A2 N] &#x2192 <a href="&sigma;NRed">SNRed</a> [g &#x22A2 <a href="#app">app</a> (<a href="#abs">abs</a> (&lambda;x. M)) N] [g &#x22A2 M[&hellip;, N]]
| <span class="constructor" id="SAppl">SAppl</span> : <a href="&sigma;NRed">SNRed</a> [g &#x22A2 R] [g &#x22A2 R'] &#x2192 <a href="&sigma;NRed">SNRed</a> [g &#x22A2 <a href="#app">app</a> R M] [g &#x22A2 <a href="#app">app</a> R' M]
| <span class="constructor" id="SCInl">SCInl</span> : <a href="&sigma;N">SN</a> [g &#x22A2 M] &#x2192 <a href="&sigma;N">SN</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 N1] &#x2192 <a href="&sigma;N">SN</a> [g, y : <a href="#tm">tm</a> B[] &#x22A2 N2] &#x2192 <a href="&sigma;NRed">SNRed</a> [g &#x22A2 <a href="#match">match</a> (<a href="#inl">inl</a> B[] M) (&lambda;x. N1) (&lambda;y. N2)] [g &#x22A2 N1[&hellip;, M]]
| <span class="constructor" id="SCInr">SCInr</span> : <a href="&sigma;N">SN</a> [g &#x22A2 M] &#x2192 <a href="&sigma;N">SN</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 N1] &#x2192 <a href="&sigma;N">SN</a> [g, y : <a href="#tm">tm</a> B[] &#x22A2 N2] &#x2192 <a href="&sigma;NRed">SNRed</a> [g &#x22A2 <a href="#match">match</a> (<a href="#inr">inr</a> A[] M) (&lambda;x. N1) (&lambda;y. N2)] [g &#x22A2 N2[&hellip;, M]]
| <span class="constructor" id="SRCase">SRCase</span> : <a href="&sigma;NRed">SNRed</a> [g &#x22A2 M] [g &#x22A2 M'] &#x2192 {N1 : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {N2 : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} <a href="&sigma;NRed">SNRed</a> [g &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)] [g &#x22A2 <a href="#match">match</a> M' (&lambda;x. N1) (&lambda;y. N2)];
<br><keyword>inductive</keyword> <span class="typ" id="SnRed">SnRed</span> : {g : <a href="#cxt">cxt</a>} &#x2192 {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 {M' : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 <keyword>ctype</keyword> = 
| <span class="constructor" id="SnBeta">SnBeta</span> : {M : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> B[]]} <a href="&sigma;n">Sn</a> [g &#x22A2 N] &#x2192 <a href="&sigma;nRed">SnRed</a> [g &#x22A2 <a href="#app">app</a> (<a href="#abs">abs</a> (&lambda;x. M)) N] [g &#x22A2 M[&hellip;, N]]
| <span class="constructor" id="SnAppl">SnAppl</span> : <a href="&sigma;nRed">SnRed</a> [g &#x22A2 M] [g &#x22A2 M'] &#x2192 <a href="&sigma;nRed">SnRed</a> [g &#x22A2 <a href="#app">app</a> M N] [g &#x22A2 <a href="#app">app</a> M' N]
| <span class="constructor" id="SnCInl">SnCInl</span> : <a href="&sigma;n">Sn</a> [g &#x22A2 M] &#x2192 <a href="&sigma;n">Sn</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 N1] &#x2192 <a href="&sigma;n">Sn</a> [g, y : <a href="#tm">tm</a> B[] &#x22A2 N2] &#x2192 <a href="&sigma;nRed">SnRed</a> [g &#x22A2 <a href="#match">match</a> (<a href="#inl">inl</a> B[] M) (&lambda;x. N1) (&lambda;y. N2)] [g &#x22A2 N1[&hellip;, M]]
| <span class="constructor" id="SnCInr">SnCInr</span> : <a href="&sigma;n">Sn</a> [g &#x22A2 M] &#x2192 <a href="&sigma;n">Sn</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 N1] &#x2192 <a href="&sigma;n">Sn</a> [g, y : <a href="#tm">tm</a> B[] &#x22A2 N2] &#x2192 <a href="&sigma;nRed">SnRed</a> [g &#x22A2 <a href="#match">match</a> (<a href="#inr">inr</a> A[] M) (&lambda;x. N1) (&lambda;y. N2)] [g &#x22A2 N2[&hellip;, M]]
| <span class="constructor" id="SnCasR">SnCasR</span> : <a href="&sigma;nRed">SnRed</a> [g &#x22A2 M] [g &#x22A2 M'] &#x2192 {N1 : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {N2 : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} <a href="&sigma;nRed">SnRed</a> [g &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)] [g &#x22A2 <a href="#match">match</a> M' (&lambda;x. N1) (&lambda;y. N2)];
<br><span class="typ" id="empty">empty</span> : <keyword>type</keyword>.
<br><keyword>rec</keyword> <span class="function" id="varSn">varSn</span> : (g:<a href="#cxt">cxt</a>) {#p : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;n">Sn</a> [g &#x22A2 #p] / total  ( varSn ) / =
<keyword>mlam</keyword> p &#x21D2 <keyword>let</keyword>  [_ &#x22A2 #p] : [g &#x22A2 <a href="#tm">tm</a> A[]]= [_ &#x22A2 #p] <keyword>in</keyword> <a href="#Acc">Acc</a> [g] [ &#x22A2 A] [g &#x22A2 #p] (<keyword>mlam</keyword> M' &#x21D2 <keyword>mlam</keyword> S &#x21D2 <keyword>impossible</keyword> [_ &#x22A2 S]);
<br><keyword>rec</keyword> <span class="function" id="abs_sn">abs_sn</span> : {g : <a href="#cxt">cxt</a>} {A : [ &#x22A2 <a href="#ty">ty</a>]} {B : [ &#x22A2 <a href="#ty">ty</a>]} {M : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> B[]]} <a href="&sigma;n">Sn</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 M] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#abs">abs</a> (&lambda;x. M)] / total s ( abs_sn g a b m s ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> A &#x21D2 <keyword>mlam</keyword> B &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>fn</keyword> sn &#x21D2 <a href="#Acc">Acc</a> [g] [ &#x22A2 <a href="#arr">arr</a> A B] [g &#x22A2 <a href="#abs">abs</a> (&lambda;x. M)] (<keyword>mlam</keyword> Q &#x21D2 <keyword>mlam</keyword> S &#x21D2 
  <keyword>let</keyword>  [g &#x22A2 <a href="#rabs">rabs</a> (&lambda;x. S1)] = [g &#x22A2 S] <keyword>in</keyword> 
  <keyword>let</keyword>  [g, x : <a href="#tm">tm</a> A[] &#x22A2 S1] : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#step">step</a> M M1]=
  [g, x : <a href="#tm">tm</a> _ &#x22A2 S1] <keyword>in</keyword> <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g, x : <a href="#tm">tm</a> A[]]) ([ &#x22A2 B]) ([g, x : <a href="#tm">tm</a> A[] &#x22A2 M]) r =
                                                                   sn <keyword>in</keyword> <a href="#abs_sn">abs_sn</a> [g] [ &#x22A2 A] [ &#x22A2 B] [g, x : <a href="#tm">tm</a> A[] &#x22A2 M1] (r [g, x : <a href="#tm">tm</a> A[] &#x22A2 M1] [g, x : <a href="#tm">tm</a> A[] &#x22A2 S1]));
<br><keyword>rec</keyword> <span class="function" id="app_sna">app_sna</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#arr">arr</a> A[] B[])]} {N : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#app">app</a> M N] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 M] / total s ( app_sna g a b m n s ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>fn</keyword> sn &#x21D2 
  <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 B[]]) ([g &#x22A2 <a href="#app">app</a> M N]) r = sn <keyword>in</keyword> <a href="#Acc">Acc</a> [_] [_ &#x22A2 _] [_ &#x22A2 _] (<keyword>mlam</keyword> M' &#x21D2 <keyword>mlam</keyword> S &#x21D2 <a href="#app_sna">app_sna</a> [_ &#x22A2 M'] [_ &#x22A2 _] (r [_ &#x22A2 <a href="#app">app</a> M' N] [_ &#x22A2 <a href="#rappl">rappl</a> S]));
<br><keyword>rec</keyword> <span class="function" id="app_snb">app_snb</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#arr">arr</a> A[] B[])]} {N : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#app">app</a> M N] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 N] / total s ( app_snb g a b m n s ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>fn</keyword> sn &#x21D2 
  <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 B[]]) ([g &#x22A2 <a href="#app">app</a> M N]) r = sn <keyword>in</keyword> <a href="#Acc">Acc</a> [_] [_ &#x22A2 _] [_ &#x22A2 _] (<keyword>mlam</keyword> N' &#x21D2 <keyword>mlam</keyword> S &#x21D2 <a href="#app_snb">app_snb</a> [_ &#x22A2 M] [_ &#x22A2 N'] (r [_ &#x22A2 <a href="#app">app</a> M N'] [_ &#x22A2 <a href="#rappr">rappr</a> S]));
<br><keyword>rec</keyword> <span class="function" id="inl_sn">inl_sn</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} {B : [ &#x22A2 <a href="#ty">ty</a>]} <a href="&sigma;n">Sn</a> [g &#x22A2 M] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#inl">inl</a> B[] M] / total sn ( inl_sn g a m b sn ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> B &#x21D2 <keyword>fn</keyword> sn &#x21D2 
  <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 A[]]) ([g &#x22A2 M]) r = sn <keyword>in</keyword> <a href="#Acc">Acc</a> [g] [ &#x22A2 <a href="#sum">sum</a> A B] [g &#x22A2 <a href="#inl">inl</a> B[] M] (<keyword>mlam</keyword> M' &#x21D2 <keyword>mlam</keyword> S &#x21D2 
  <keyword>let</keyword>  [g &#x22A2 <a href="#rinl">rinl</a> S'] = [g &#x22A2 S] <keyword>in</keyword> <a href="#inl_sn">inl_sn</a> [_ &#x22A2 _] [ &#x22A2 B] (r [_ &#x22A2 _] [_ &#x22A2 S']));
<br><keyword>rec</keyword> <span class="function" id="inr_sn">inr_sn</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> B[]]} {A : [ &#x22A2 <a href="#ty">ty</a>]} <a href="&sigma;n">Sn</a> [g &#x22A2 M] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#inr">inr</a> A[] M] / total sn ( inr_sn g b m a sn ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> A &#x21D2 <keyword>fn</keyword> sn &#x21D2 
  <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 B[]]) ([g &#x22A2 M]) r = sn <keyword>in</keyword> <a href="#Acc">Acc</a> [g] [ &#x22A2 <a href="#sum">sum</a> A B] [g &#x22A2 <a href="#inr">inr</a> A[] M] (<keyword>mlam</keyword> M' &#x21D2 <keyword>mlam</keyword> S &#x21D2 
  <keyword>let</keyword>  [g &#x22A2 <a href="#rinr">rinr</a> S'] = [g &#x22A2 S] <keyword>in</keyword> <a href="#inr_sn">inr_sn</a> [_ &#x22A2 _] [ &#x22A2 A] (r [_ &#x22A2 _] [_ &#x22A2 S']));
<br><keyword>rec</keyword> <span class="function" id="case_sna">case_sna</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} {N1 : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {N2 : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 M] / total sn ( case_sna g a b c m n1 n2 sn ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N1 &#x21D2 <keyword>mlam</keyword> N2 &#x21D2 <keyword>fn</keyword> sn &#x21D2 
  <keyword>let</keyword>  [_ &#x22A2 M] : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]= [_ &#x22A2 M] <keyword>in</keyword> 
  <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 C]) ([g &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)]) r = sn <keyword>in</keyword> <a href="#Acc">Acc</a> [g] [ &#x22A2 <a href="#sum">sum</a> A[] B[]] [g &#x22A2 M] (<keyword>mlam</keyword> M' &#x21D2 <keyword>mlam</keyword> S &#x21D2 <a href="#case_sna">case_sna</a> [_ &#x22A2 M'] [_ &#x22A2 N1] [_ &#x22A2 N2] (r [_ &#x22A2 _] [_ &#x22A2 <a href="#rcase">rcase</a> S]));
<br><keyword>rec</keyword> <span class="function" id="case_snb">case_snb</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} {N1 : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {N2 : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)] &#x2192 <a href="&sigma;n">Sn</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 N1] / total sn ( case_snb g a b c m n1 n2 sn ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N1 &#x21D2 <keyword>mlam</keyword> N2 &#x21D2 <keyword>fn</keyword> sn &#x21D2 
  <keyword>let</keyword>  [_ &#x22A2 N1] : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]= [_ &#x22A2 N1] <keyword>in</keyword> 
  <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 C]) ([g &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)]) r = sn <keyword>in</keyword> <a href="#Acc">Acc</a> [g, x : <a href="#tm">tm</a> A[]] [ &#x22A2 C] [g, x : <a href="#tm">tm</a> A[] &#x22A2 N1] (<keyword>mlam</keyword> N1' &#x21D2 <keyword>mlam</keyword> S &#x21D2 <a href="#case_snb">case_snb</a> [_ &#x22A2 M] [_ &#x22A2 N1'] [_ &#x22A2 N2] (r [_ &#x22A2 _] [_ &#x22A2 <a href="#rcl">rcl</a> (&lambda;x. S)]));
<br><keyword>rec</keyword> <span class="function" id="case_snc">case_snc</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} {N1 : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {N2 : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)] &#x2192 <a href="&sigma;n">Sn</a> [g, y : <a href="#tm">tm</a> B[] &#x22A2 N2] / total sn ( case_snc g a b c m n1 n2 sn ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N1 &#x21D2 <keyword>mlam</keyword> N2 &#x21D2 <keyword>fn</keyword> sn &#x21D2 
  <keyword>let</keyword>  [_ &#x22A2 N2] : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]= [_ &#x22A2 N2] <keyword>in</keyword> 
  <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 C]) ([g &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)]) r = sn <keyword>in</keyword> <a href="#Acc">Acc</a> [g, y : <a href="#tm">tm</a> B[]] [ &#x22A2 C] [g, y : <a href="#tm">tm</a> B[] &#x22A2 N2] (<keyword>mlam</keyword> N2' &#x21D2 <keyword>mlam</keyword> S &#x21D2 <a href="#case_snc">case_snc</a> [_ &#x22A2 M] [_ &#x22A2 N1] [_ &#x22A2 N2'] (r [_ &#x22A2 _] [_ &#x22A2 <a href="#rcr">rcr</a> (&lambda;y. S)]));
<br><keyword>rec</keyword> <span class="function" id="app_abs_sn">app_abs_sn</span> : {g : <a href="#cxt">cxt</a>} {A : [ &#x22A2 <a href="#ty">ty</a>]} {B : [ &#x22A2 <a href="#ty">ty</a>]} {M : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> B[]]} {N : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;n">Sn</a> [g &#x22A2 M[&hellip;, N]] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 N] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#app">app</a> (<a href="#abs">abs</a> (&lambda;x. M)) N] / total {sn2 sn1} ( app_abs_sn g a b m n sn1 sn2 ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> A &#x21D2 <keyword>mlam</keyword> B &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>fn</keyword> sn1 &#x21D2 <keyword>fn</keyword> sn2 &#x21D2 <a href="#Acc">Acc</a> [g] [ &#x22A2 B] [g &#x22A2 <a href="#app">app</a> (<a href="#abs">abs</a> (&lambda;x. M)) N] (<keyword>mlam</keyword> P &#x21D2 <keyword>mlam</keyword> S &#x21D2 <keyword>case</keyword> [_ &#x22A2 S] <keyword>of</keyword> 
  | [g &#x22A2 <a href="#rbeta">rbeta</a>] &#x21D2 sn1
  | [g &#x22A2 <a href="#rappl">rappl</a> S'] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 <a href="#rabs">rabs</a> (&lambda;x. S'')] = [_ &#x22A2 S'] <keyword>in</keyword> 
    <keyword>let</keyword>  [_ &#x22A2 S''] : [g, x : <a href="#tm">tm</a> _ &#x22A2 <a href="#step">step</a> M M']= [_ &#x22A2 S''] <keyword>in</keyword> 
    <keyword>let</keyword>  [_ &#x22A2 S'''] = [_ &#x22A2 S''[&hellip;, N]] <keyword>in</keyword> 
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 B]) ([g &#x22A2 _]) r = sn1 <keyword>in</keyword> <a href="#app_abs_sn">app_abs_sn</a> [g] [ &#x22A2 _] [ &#x22A2 _] [_ &#x22A2 M'] [_ &#x22A2 N] (r [_ &#x22A2 M'[&hellip;, N]] [_ &#x22A2 S''']) sn2
  | [g &#x22A2 <a href="#rappr">rappr</a> S'] &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 A]) ([g &#x22A2 N]) r = sn2 <keyword>in</keyword> 
    <keyword>let</keyword>  [_ &#x22A2 S'] : [_ &#x22A2 <a href="#step">step</a> N N']= [_ &#x22A2 S'] <keyword>in</keyword> 
    <keyword>let</keyword>  [_ &#x22A2 MS''] = <a href="#subst_mred">subst_mred</a> [_ &#x22A2 M] [_ &#x22A2 N] [_ &#x22A2 N'] [_ &#x22A2 S'] <keyword>in</keyword> 
    <keyword>let</keyword> sn' = <a href="#mstep_sn">mstep_sn</a> [_ &#x22A2 M[&hellip;, N]] [_ &#x22A2 M[&hellip;, N']] [_ &#x22A2 MS''] sn1 <keyword>in</keyword>
    <a href="#app_abs_sn">app_abs_sn</a> [g] [ &#x22A2 _] [ &#x22A2 _] [_ &#x22A2 M] [_ &#x22A2 N'] sn' (r [_ &#x22A2 N'] [_ &#x22A2 S']));
<br><keyword>inductive</keyword> <span class="typ" id="Neutral">Neutral</span> : {g : <a href="#cxt">cxt</a>} &#x2192 {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 <keyword>ctype</keyword> = 
| <span class="constructor" id="Nvar">Nvar</span> : {#x : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="#Neutral">Neutral</a> [g &#x22A2 #x]
| <span class="constructor" id="Napp">Napp</span> : {R : [g &#x22A2 <a href="#tm">tm</a> (<a href="#arr">arr</a> A[] B[])]} {N : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="#Neutral">Neutral</a> [g &#x22A2 R] &#x2192 <a href="#Neutral">Neutral</a> [g &#x22A2 <a href="#app">app</a> R N]
| <span class="constructor" id="Ncase">Ncase</span> : {R : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} {N1 : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {N2 : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} <a href="#Neutral">Neutral</a> [g &#x22A2 R] &#x2192 <a href="#Neutral">Neutral</a> [g &#x22A2 <a href="#match">match</a> R (&lambda;x. N1) (&lambda;y. N2)];
<br><keyword>rec</keyword> <span class="function" id="neu_step">neu_step</span> : (g:<a href="#cxt">cxt</a>) {R : [g &#x22A2 <a href="#tm">tm</a> A[]]} {R' : [g &#x22A2 <a href="#tm">tm</a> A[]]} [g &#x22A2 <a href="#step">step</a> R R'] &#x2192 <a href="#Neutral">Neutral</a> [g &#x22A2 R] &#x2192 <a href="#Neutral">Neutral</a> [g &#x22A2 R'] / total s ( neu_step g a r r' s n ) / =
<keyword>mlam</keyword> R &#x21D2 <keyword>mlam</keyword> R' &#x21D2 <keyword>fn</keyword> s &#x21D2 <keyword>fn</keyword> neu &#x21D2 <keyword>case</keyword> neu <keyword>of</keyword> 
  | <a href="#Nvar">Nvar</a> ([g &#x22A2 #x])  &#x21D2 <keyword>impossible</keyword> s
  | <a href="#Napp">Napp</a> ([g &#x22A2 R'']) ([g &#x22A2 N]) neu'  &#x21D2
    <keyword>case</keyword> s <keyword>of</keyword> 
    | [g &#x22A2 <a href="#rbeta">rbeta</a>] &#x21D2 <keyword>impossible</keyword> neu'
    | [g &#x22A2 <a href="#rappl">rappl</a> S'] &#x21D2
      <keyword>let</keyword> neu'' = <a href="#neu_step">neu_step</a> [_ &#x22A2 R''] [_ &#x22A2 _] [_ &#x22A2 S'] neu' <keyword>in</keyword>
      <a href="#Napp">Napp</a> [_ &#x22A2 _] [_ &#x22A2 N] neu''
    | [g &#x22A2 <a href="#rappr">rappr</a> S'] &#x21D2 <a href="#Napp">Napp</a> [_ &#x22A2 R''] [_ &#x22A2 _] neu'
  | <a href="#Ncase">Ncase</a> ([g &#x22A2 R'']) ([g, x : <a href="#tm">tm</a> A[] &#x22A2 N1]) ([g, y : <a href="#tm">tm</a> B[] &#x22A2 N2]) neu'  &#x21D2
    <keyword>case</keyword> s <keyword>of</keyword> 
    | [g &#x22A2 <a href="#rcase">rcase</a> S'] &#x21D2
      <keyword>let</keyword> neu'' = <a href="#neu_step">neu_step</a> [_ &#x22A2 R''] [_ &#x22A2 _] [_ &#x22A2 S'] neu' <keyword>in</keyword>
      <a href="#Ncase">Ncase</a> [_ &#x22A2 _] [_ &#x22A2 N1] [_ &#x22A2 N2] neu''
    | [g &#x22A2 <a href="#rcinl">rcinl</a>] &#x21D2 <keyword>impossible</keyword> neu'
    | [g &#x22A2 <a href="#rcinr">rcinr</a>] &#x21D2 <keyword>impossible</keyword> neu'
    | [g &#x22A2 <a href="#rcl">rcl</a> (&lambda;x. S')] &#x21D2 <a href="#Ncase">Ncase</a> [_ &#x22A2 R''] [_ &#x22A2 _] [_ &#x22A2 N2] neu'
    | [g &#x22A2 <a href="#rcr">rcr</a> (&lambda;y. S')] &#x21D2 <a href="#Ncase">Ncase</a> [_ &#x22A2 R''] [_ &#x22A2 N1] [_ &#x22A2 _] neu';
<br><keyword>rec</keyword> <span class="function" id="app_sn">app_sn</span> : {g : <a href="#cxt">cxt</a>} {A : [ &#x22A2 <a href="#ty">ty</a>]} {B : [ &#x22A2 <a href="#ty">ty</a>]} {R : [g &#x22A2 <a href="#tm">tm</a> (<a href="#arr">arr</a> A[] B[])]} {N : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="#Neutral">Neutral</a> [g &#x22A2 R] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 R] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 N] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#app">app</a> R N] / total {sn1 sn2} ( app_sn g a b r n neu sn1 sn2 ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> A &#x21D2 <keyword>mlam</keyword> B &#x21D2 <keyword>mlam</keyword> R &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>fn</keyword> neu &#x21D2 <keyword>fn</keyword> sn1 &#x21D2 <keyword>fn</keyword> sn2 &#x21D2 <a href="#Acc">Acc</a> [g] [ &#x22A2 B] [g &#x22A2 <a href="#app">app</a> R N] (<keyword>mlam</keyword> Q &#x21D2 <keyword>mlam</keyword> S &#x21D2 <keyword>case</keyword> [g &#x22A2 S] <keyword>of</keyword> 
  | [g &#x22A2 <a href="#rbeta">rbeta</a>] &#x21D2 <keyword>impossible</keyword> neu
  | [g &#x22A2 <a href="#rappl">rappl</a> S'] &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 <a href="#arr">arr</a> A B]) ([g &#x22A2 R]) r = sn1 <keyword>in</keyword> 
    <keyword>let</keyword> neu' = <a href="#neu_step">neu_step</a> [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 S'] neu <keyword>in</keyword>
    <a href="#app_sn">app_sn</a> [g] [ &#x22A2 A] [ &#x22A2 B] [g &#x22A2 _] [g &#x22A2 N] neu' (r [_ &#x22A2 _] [_ &#x22A2 S']) sn2
  | [g &#x22A2 <a href="#rappr">rappr</a> S'] &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 A]) ([g &#x22A2 N]) r = sn2 <keyword>in</keyword> <a href="#app_sn">app_sn</a> [g] [ &#x22A2 A] [ &#x22A2 B] [_ &#x22A2 R] [_ &#x22A2 _] neu sn1 (r [_ &#x22A2 _] [_ &#x22A2 S']));
<br><keyword>rec</keyword> <span class="function" id="match_sn">match_sn</span> : (g:<a href="#cxt">cxt</a>) {R : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} {N1 : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {N2 : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} <a href="#Neutral">Neutral</a> [g &#x22A2 R] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 R] &#x2192 <a href="&sigma;n">Sn</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 N1] &#x2192 <a href="&sigma;n">Sn</a> [g, y : <a href="#tm">tm</a> B[] &#x22A2 N2] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#match">match</a> R (&lambda;x. N1) (&lambda;y. N2)] / total {sn0 sn1 sn2} ( match_sn g a b c r n1 n2 neu sn0 sn1 sn2 ) / =
<keyword>mlam</keyword> R &#x21D2 <keyword>mlam</keyword> N1 &#x21D2 <keyword>mlam</keyword> N2 &#x21D2 <keyword>fn</keyword> neu &#x21D2 <keyword>fn</keyword> sn0 &#x21D2 <keyword>fn</keyword> sn1 &#x21D2 <keyword>fn</keyword> sn2 &#x21D2 
  <keyword>let</keyword>  [_ &#x22A2 N1] : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]= [_ &#x22A2 N1] <keyword>in</keyword> <a href="#Acc">Acc</a> [g] [ &#x22A2 C] [g &#x22A2 <a href="#match">match</a> R (&lambda;x. N1) (&lambda;y. N2)] (<keyword>mlam</keyword> M' &#x21D2 <keyword>mlam</keyword> S &#x21D2 <keyword>case</keyword> [g &#x22A2 S] <keyword>of</keyword> 
  | [g &#x22A2 <a href="#rcase">rcase</a> S'] &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 <a href="#sum">sum</a> A[] B[]]) ([g &#x22A2 R]) r = sn0 <keyword>in</keyword> 
    <keyword>let</keyword> neu' = <a href="#neu_step">neu_step</a> [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 S'] neu <keyword>in</keyword>
    <a href="#match_sn">match_sn</a> [_ &#x22A2 _] [_ &#x22A2 N1] [_ &#x22A2 N2] neu' (r [_ &#x22A2 _] [_ &#x22A2 S']) sn1 sn2
  | [g &#x22A2 <a href="#rcinl">rcinl</a>] &#x21D2 <keyword>impossible</keyword> neu
  | [g &#x22A2 <a href="#rcinr">rcinr</a>] &#x21D2 <keyword>impossible</keyword> neu
  | [g &#x22A2 <a href="#rcl">rcl</a> (&lambda;x. S')] &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g, x : <a href="#tm">tm</a> A[]]) ([ &#x22A2 C[]]) ([g, x : <a href="#tm">tm</a> A[] &#x22A2 N1]) r = sn1 <keyword>in</keyword> <a href="#match_sn">match_sn</a> [_ &#x22A2 R] [_ &#x22A2 _] [_ &#x22A2 N2] neu sn0 (r [_ &#x22A2 _] [_ &#x22A2 S']) sn2
  | [g &#x22A2 <a href="#rcr">rcr</a> (&lambda;y. S')] &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g, y : <a href="#tm">tm</a> B[]]) ([ &#x22A2 C[]]) ([g, y : <a href="#tm">tm</a> B[] &#x22A2 N2]) r = sn2 <keyword>in</keyword> <a href="#match_sn">match_sn</a> [_ &#x22A2 R] [_ &#x22A2 N1] [_ &#x22A2 _] neu sn0 sn1 (r [_ &#x22A2 _] [_ &#x22A2 S']));
<br><keyword>rec</keyword> <span class="function" id="casel_sn">casel_sn</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} {N1 : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {N2 : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} <a href="&sigma;n">Sn</a> [g &#x22A2 M] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 N1[&hellip;, M]] &#x2192 <a href="&sigma;n">Sn</a> [g, y : <a href="#tm">tm</a> B[] &#x22A2 N2] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#match">match</a> (<a href="#inl">inl</a> B[] M) (&lambda;x. N1) (&lambda;y. N2)] / total {sn0 sn1 sn2} ( casel_sn g a b c m n1 n2 sn0 sn1 sn2 ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N1 &#x21D2 <keyword>mlam</keyword> N2 &#x21D2 <keyword>fn</keyword> sn0 &#x21D2 <keyword>fn</keyword> sn1 &#x21D2 <keyword>fn</keyword> sn2 &#x21D2 
  <keyword>let</keyword>  [_ &#x22A2 N1] : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]= [_ &#x22A2 N1] <keyword>in</keyword> 
  <keyword>let</keyword>  [_ &#x22A2 N2] : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]= [_ &#x22A2 N2] <keyword>in</keyword> <a href="#Acc">Acc</a> [g] [ &#x22A2 C] [g &#x22A2 <a href="#match">match</a> (<a href="#inl">inl</a> B[] M) (&lambda;x. N1) (&lambda;y. N2)] (<keyword>mlam</keyword> P &#x21D2 <keyword>mlam</keyword> S &#x21D2 <keyword>case</keyword> [g &#x22A2 S] <keyword>of</keyword> 
  | [g &#x22A2 <a href="#rcase">rcase</a> (<a href="#rinl">rinl</a> S')] &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 A]) ([g &#x22A2 M]) r = sn0 <keyword>in</keyword> 
    <keyword>let</keyword> ms = <a href="#subst_mred">subst_mred</a> [_ &#x22A2 N1] [_ &#x22A2 M] [_ &#x22A2 _] [_ &#x22A2 S'] <keyword>in</keyword>
    <keyword>let</keyword> sn1' = <a href="#mstep_sn">mstep_sn</a> [_ &#x22A2 N1[&hellip;, M]] [_ &#x22A2 _] ms sn1 <keyword>in</keyword>
    <a href="#casel_sn">casel_sn</a> [_ &#x22A2 _] [_ &#x22A2 N1] [_ &#x22A2 N2] (r [_ &#x22A2 _] [_ &#x22A2 S']) sn1' sn2
  | [g &#x22A2 <a href="#rcinl">rcinl</a>] &#x21D2 sn1
  | [g &#x22A2 <a href="#rcl">rcl</a> (&lambda;x. S')] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 S''] = [_ &#x22A2 S'[&hellip;, M]] <keyword>in</keyword> 
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 C]) ([g &#x22A2 _]) r = sn1 <keyword>in</keyword> <a href="#casel_sn">casel_sn</a> [_ &#x22A2 M] [_ &#x22A2 _] [_ &#x22A2 N2] sn0 (r [_ &#x22A2 _] [_ &#x22A2 S'']) sn2
  | [g &#x22A2 <a href="#rcr">rcr</a> (&lambda;y. S')] &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g, y : <a href="#tm">tm</a> B[]]) ([ &#x22A2 C]) ([g, y : <a href="#tm">tm</a> B[] &#x22A2 N2]) r = sn2 <keyword>in</keyword> <a href="#casel_sn">casel_sn</a> [_ &#x22A2 M] [_ &#x22A2 N1] [_ &#x22A2 _] sn0 sn1 (r [_ &#x22A2 _] [_ &#x22A2 S']));
<br><keyword>rec</keyword> <span class="function" id="caser_sn">caser_sn</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> B[]]} {N1 : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {N2 : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} <a href="&sigma;n">Sn</a> [g &#x22A2 M] &#x2192 <a href="&sigma;n">Sn</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 N1] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 N2[&hellip;, M]] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#match">match</a> (<a href="#inr">inr</a> A[] M) (&lambda;x. N1) (&lambda;y. N2)] / total {sn0 sn1 sn2} ( caser_sn g b a c m n1 n2 sn0 sn1 sn2 ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N1 &#x21D2 <keyword>mlam</keyword> N2 &#x21D2 <keyword>fn</keyword> sn0 &#x21D2 <keyword>fn</keyword> sn1 &#x21D2 <keyword>fn</keyword> sn2 &#x21D2 
  <keyword>let</keyword>  [_ &#x22A2 N1] : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]= [_ &#x22A2 N1] <keyword>in</keyword> 
  <keyword>let</keyword>  [_ &#x22A2 N2] : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]= [_ &#x22A2 N2] <keyword>in</keyword> <a href="#Acc">Acc</a> [g] [ &#x22A2 C] [g &#x22A2 <a href="#match">match</a> (<a href="#inr">inr</a> A[] M) (&lambda;x. N1) (&lambda;y. N2)] (<keyword>mlam</keyword> P &#x21D2 <keyword>mlam</keyword> S &#x21D2 <keyword>case</keyword> [g &#x22A2 S] <keyword>of</keyword> 
  | [g &#x22A2 <a href="#rcase">rcase</a> (<a href="#rinr">rinr</a> S')] &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 B]) ([g &#x22A2 M]) r = sn0 <keyword>in</keyword> 
    <keyword>let</keyword> ms = <a href="#subst_mred">subst_mred</a> [g, x : <a href="#tm">tm</a> B[] &#x22A2 N2] [g &#x22A2 M[&hellip;]] [g &#x22A2 _] [g &#x22A2 S'] <keyword>in</keyword>
    <keyword>let</keyword> sn2' = <a href="#mstep_sn">mstep_sn</a> [g &#x22A2 N2[&hellip;, M]] [g &#x22A2 _] ms sn2 <keyword>in</keyword>
    <a href="#caser_sn">caser_sn</a> [g &#x22A2 _] [g, x : <a href="#tm">tm</a> A[] &#x22A2 N1] [g, x : <a href="#tm">tm</a> B[] &#x22A2 N2] (r [g &#x22A2 _] [g &#x22A2 S']) sn1 sn2'
  | [g &#x22A2 <a href="#rcinr">rcinr</a>] &#x21D2 sn2
  | [g &#x22A2 <a href="#rcl">rcl</a> (&lambda;x. S')] &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g, x : <a href="#tm">tm</a> A[]]) ([ &#x22A2 C]) ([g, x : <a href="#tm">tm</a> A[] &#x22A2 N1]) r = sn1 <keyword>in</keyword> <a href="#caser_sn">caser_sn</a> [_ &#x22A2 M] [_ &#x22A2 _] [_ &#x22A2 N2] sn0 (r [_ &#x22A2 _] [_ &#x22A2 S']) sn2
  | [g &#x22A2 <a href="#rcr">rcr</a> (&lambda;y. S')] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 S''] = [_ &#x22A2 S'[&hellip;, M]] <keyword>in</keyword> 
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 C]) ([g &#x22A2 _]) r = sn2 <keyword>in</keyword> <a href="#caser_sn">caser_sn</a> [_ &#x22A2 M] [_ &#x22A2 N1] [_ &#x22A2 _] sn0 sn1 (r [_ &#x22A2 _] [_ &#x22A2 S'']));
<br><keyword>inductive</keyword> <span class="typ" id="ConfResult">ConfResult</span> : {g : <a href="#cxt">cxt</a>} &#x2192 {N : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 {N' : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 <keyword>ctype</keyword> = 
| <span class="constructor" id="Eq">Eq</span> : <a href="#ConfResult">ConfResult</a> [g &#x22A2 N] [g &#x22A2 N]
| <span class="constructor" id="Conf">Conf</span> : <a href="&sigma;nRed">SnRed</a> [g &#x22A2 N'] [g &#x22A2 Q] &#x2192 [g &#x22A2 <a href="#mstep">mstep</a> N Q] &#x2192 <a href="#ConfResult">ConfResult</a> [g &#x22A2 N] [g &#x22A2 N'];
<br><keyword>rec</keyword> <span class="function" id="confluence">confluence</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} {N : [g &#x22A2 <a href="#tm">tm</a> A[]]} {N' : [g &#x22A2 <a href="#tm">tm</a> A[]]} {S : [g &#x22A2 <a href="#step">step</a> M N']} <a href="&sigma;nRed">SnRed</a> [g &#x22A2 M] [g &#x22A2 N] &#x2192 <a href="#ConfResult">ConfResult</a> [g &#x22A2 N] [g &#x22A2 N'] / total s ( confluence g a m n n' s ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>mlam</keyword> N' &#x21D2 <keyword>mlam</keyword> S &#x21D2 <keyword>fn</keyword> snr &#x21D2 <keyword>case</keyword> snr <keyword>of</keyword> 
  | <a href="&sigma;nBeta">SnBeta</a> ([g, x : <a href="#tm">tm</a> A[] &#x22A2 M]) sn  &#x21D2
    <keyword>case</keyword> [g &#x22A2 S] <keyword>of</keyword> 
    | [g &#x22A2 <a href="#rbeta">rbeta</a>] &#x21D2 <a href="#Eq">Eq</a>
    | [g &#x22A2 <a href="#rappl">rappl</a> S'] &#x21D2
      <keyword>let</keyword>  [_ &#x22A2 <a href="#rabs">rabs</a> (&lambda;x. S'')] = [_ &#x22A2 S'] <keyword>in</keyword> 
      <keyword>let</keyword>  [_ &#x22A2 S''] : [g, x : <a href="#tm">tm</a> _ &#x22A2 <a href="#step">step</a> M M']= [_ &#x22A2 S''] <keyword>in</keyword> 
      <keyword>let</keyword> snr' = <a href="&sigma;nBeta">SnBeta</a> [g, x : <a href="#tm">tm</a> _ &#x22A2 M'] sn <keyword>in</keyword>
      <keyword>let</keyword>  sn : <a href="&sigma;n">Sn</a> [g &#x22A2 N]= sn <keyword>in</keyword> 
      <keyword>let</keyword>  [_ &#x22A2 R] = [_ &#x22A2 S''[&hellip;, N]] <keyword>in</keyword> <a href="#Conf">Conf</a> snr' [g &#x22A2 <a href="#m-step">m-step</a> R <a href="#m-refl">m-refl</a>]
    | [g &#x22A2 <a href="#rappr">rappr</a> S'] &#x21D2
      <keyword>let</keyword>  [_ &#x22A2 S'] : [_ &#x22A2 <a href="#step">step</a> N N']= [_ &#x22A2 S'] <keyword>in</keyword> 
      <keyword>let</keyword> ms = <a href="#subst_mred">subst_mred</a> [_ &#x22A2 M] [_ &#x22A2 N] [_ &#x22A2 N'] [_ &#x22A2 S'] <keyword>in</keyword>
      <keyword>let</keyword>  <a href="#Acc">Acc</a> ([_]) ([ &#x22A2 _]) ([_ &#x22A2 _]) r = sn <keyword>in</keyword> 
      <keyword>let</keyword> sn' = r [_ &#x22A2 N'] [_ &#x22A2 S'] <keyword>in</keyword> <a href="#Conf">Conf</a> (<a href="&sigma;nBeta">SnBeta</a> [g, x : <a href="#tm">tm</a> _ &#x22A2 M] sn') ms
  | <a href="&sigma;nAppl">SnAppl</a> r  &#x21D2
    <keyword>case</keyword> [_ &#x22A2 S] <keyword>of</keyword> 
    | [g &#x22A2 <a href="#rbeta">rbeta</a>] &#x21D2 <keyword>impossible</keyword> r
    | [g &#x22A2 <a href="#rappl">rappl</a> S'] &#x21D2
      <keyword>let</keyword> conf = <a href="#confluence">confluence</a> [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 S'] r <keyword>in</keyword>
      <keyword>case</keyword> conf <keyword>of</keyword> 
      | <a href="#Eq">Eq</a>  &#x21D2 <a href="#Eq">Eq</a>
      | <a href="#Conf">Conf</a> snr' ms  &#x21D2
        <keyword>let</keyword>  snr' : <a href="&sigma;nRed">SnRed</a> [g &#x22A2 M2] [g &#x22A2 P]= snr' <keyword>in</keyword> 
        <keyword>let</keyword> ms' = <a href="#mstep_appl">mstep_appl</a> [_ &#x22A2 _] [_ &#x22A2 P] [_ &#x22A2 _] ms <keyword>in</keyword>
        <a href="#Conf">Conf</a> (<a href="&sigma;nAppl">SnAppl</a> snr') ms'
    | [g &#x22A2 <a href="#rappr">rappr</a> S'] &#x21D2
      <keyword>let</keyword> ms = [_ &#x22A2 <a href="#m-step">m-step</a> S' <a href="#m-refl">m-refl</a>] <keyword>in</keyword>
      <keyword>let</keyword>  r : <a href="&sigma;nRed">SnRed</a> [_ &#x22A2 M] [_ &#x22A2 M']= r <keyword>in</keyword> 
      <keyword>let</keyword> ms' = <a href="#mstep_appr">mstep_appr</a> [_ &#x22A2 M'] [_ &#x22A2 _] [_ &#x22A2 _] ms <keyword>in</keyword>
      <a href="#Conf">Conf</a> (<a href="&sigma;nAppl">SnAppl</a> r) ms'
  | <a href="&sigma;nCInl">SnCInl</a> sn sn1 sn2  &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 <a href="#sum">sum</a> A1[] A2[]]) ([g &#x22A2 M0]) r = sn <keyword>in</keyword> <keyword>case</keyword> [g &#x22A2 S] <keyword>of</keyword> 
    | [g &#x22A2 <a href="#rcase">rcase</a> (<a href="#rinl">rinl</a> S')] &#x21D2
      <keyword>let</keyword> sn' = r [_ &#x22A2 _] [_ &#x22A2 S'] <keyword>in</keyword>
      <keyword>let</keyword> snr' = <a href="&sigma;nCInl">SnCInl</a> sn' sn1 sn2 <keyword>in</keyword>
      <keyword>let</keyword>  <a href="#Acc">Acc</a> ([_]) ([ &#x22A2 _]) ([_ &#x22A2 N1]) r = sn1 <keyword>in</keyword> 
      <keyword>let</keyword> ms = <a href="#subst_mred">subst_mred</a> [_ &#x22A2 N1] [_ &#x22A2 M0] [_ &#x22A2 _] [_ &#x22A2 S'] <keyword>in</keyword> <a href="#Conf">Conf</a> snr' ms
    | [g &#x22A2 <a href="#rcinl">rcinl</a>] &#x21D2 <a href="#Eq">Eq</a>
    | [g &#x22A2 <a href="#rcl">rcl</a> (&lambda;x. S')] &#x21D2
      <keyword>let</keyword>  [_ &#x22A2 S'] : [g, x : <a href="#tm">tm</a> _ &#x22A2 <a href="#step">step</a> N1 N1']= [_ &#x22A2 S'] <keyword>in</keyword> 
      <keyword>let</keyword>  [_ &#x22A2 S''] = [_ &#x22A2 S'[&hellip;, M0]] <keyword>in</keyword> 
      <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g, x : <a href="#tm">tm</a> A[]]) ([ &#x22A2 C]) ([g, x : <a href="#tm">tm</a> A[] &#x22A2 N1]) r = sn1 <keyword>in</keyword> 
      <keyword>let</keyword> sn1' = r [_ &#x22A2 N1'] [_ &#x22A2 S'] <keyword>in</keyword>
      <keyword>let</keyword> snr' = <a href="&sigma;nCInl">SnCInl</a> sn sn1' sn2 <keyword>in</keyword>
      <a href="#Conf">Conf</a> snr' [g &#x22A2 <a href="#m-step">m-step</a> S'' <a href="#m-refl">m-refl</a>]
    | [g &#x22A2 <a href="#rcr">rcr</a> (&lambda;y. S')] &#x21D2
      <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g, y : <a href="#tm">tm</a> A2[]]) ([ &#x22A2 C[]]) ([g, y : <a href="#tm">tm</a> A2[] &#x22A2 N2]) r' = sn2 <keyword>in</keyword> 
      <keyword>let</keyword> sn2' = r' [_ &#x22A2 _] [_ &#x22A2 S'] <keyword>in</keyword>
      <keyword>let</keyword> snr' = <a href="&sigma;nCInl">SnCInl</a> sn sn1 sn2' <keyword>in</keyword> <a href="#Conf">Conf</a> snr' [g &#x22A2 <a href="#m-refl">m-refl</a>]
  | <a href="&sigma;nCInr">SnCInr</a> sn sn1 sn2  &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 <a href="#sum">sum</a> A1[] A2[]]) ([g &#x22A2 M0]) r = sn <keyword>in</keyword> <keyword>case</keyword> [g &#x22A2 S] <keyword>of</keyword> 
    | [g &#x22A2 <a href="#rcase">rcase</a> (<a href="#rinr">rinr</a> S')] &#x21D2
      <keyword>let</keyword> sn' = r [_ &#x22A2 _] [_ &#x22A2 S'] <keyword>in</keyword>
      <keyword>let</keyword>  <a href="#Acc">Acc</a> ([_]) ([ &#x22A2 _]) ([_ &#x22A2 N2]) r = sn2 <keyword>in</keyword> 
      <keyword>let</keyword> snr' = <a href="&sigma;nCInr">SnCInr</a> sn' sn1 sn2 <keyword>in</keyword>
      <keyword>let</keyword> ms = <a href="#subst_mred">subst_mred</a> [_ &#x22A2 N2] [_ &#x22A2 M0] [_ &#x22A2 _] [_ &#x22A2 S'] <keyword>in</keyword> <a href="#Conf">Conf</a> snr' ms
    | [g &#x22A2 <a href="#rcinr">rcinr</a>] &#x21D2 <a href="#Eq">Eq</a>
    | [g &#x22A2 <a href="#rcl">rcl</a> (&lambda;x. S')] &#x21D2
      <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g, x : <a href="#tm">tm</a> A1[]]) ([ &#x22A2 C[]]) ([g, x : <a href="#tm">tm</a> A1[] &#x22A2 N1]) r' = sn1 <keyword>in</keyword> 
      <keyword>let</keyword> sn1' = r' [_ &#x22A2 _] [_ &#x22A2 S'] <keyword>in</keyword>
      <keyword>let</keyword>  <a href="#Acc">Acc</a> ([_]) ([ &#x22A2 _]) ([_ &#x22A2 N2]) r = sn2 <keyword>in</keyword> 
      <keyword>let</keyword> snr' = <a href="&sigma;nCInr">SnCInr</a> sn sn1' sn2 <keyword>in</keyword> <a href="#Conf">Conf</a> snr' [g &#x22A2 <a href="#m-refl">m-refl</a>]
    | [g &#x22A2 <a href="#rcr">rcr</a> (&lambda;x. S')] &#x21D2
      <keyword>let</keyword>  [_ &#x22A2 S'] : [g, x : <a href="#tm">tm</a> _ &#x22A2 <a href="#step">step</a> N2 N2']= [_ &#x22A2 S'] <keyword>in</keyword> 
      <keyword>let</keyword>  [_ &#x22A2 S''] = [_ &#x22A2 S'[&hellip;, M0]] <keyword>in</keyword> 
      <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g, y : <a href="#tm">tm</a> B[]]) ([ &#x22A2 C]) ([g, y : <a href="#tm">tm</a> B[] &#x22A2 N2]) r = sn2 <keyword>in</keyword> 
      <keyword>let</keyword> sn2' = r [_ &#x22A2 N2'] [_ &#x22A2 S'] <keyword>in</keyword>
      <keyword>let</keyword> snr' = <a href="&sigma;nCInr">SnCInr</a> sn sn1 sn2' <keyword>in</keyword>
      <a href="#Conf">Conf</a> snr' [g &#x22A2 <a href="#m-step">m-step</a> S'' <a href="#m-refl">m-refl</a>]
  | <a href="&sigma;nCasR">SnCasR</a> snr' ([g, x : <a href="#tm">tm</a> A[] &#x22A2 N1]) ([g, y : <a href="#tm">tm</a> B[] &#x22A2 N2])  &#x21D2
    <keyword>case</keyword> [g &#x22A2 S] <keyword>of</keyword> 
    | [g &#x22A2 <a href="#rcase">rcase</a> S'] &#x21D2
      <keyword>let</keyword> conf = <a href="#confluence">confluence</a> [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 S'] snr' <keyword>in</keyword>
      <keyword>case</keyword> conf <keyword>of</keyword> 
      | <a href="#Eq">Eq</a>  &#x21D2 <a href="#Eq">Eq</a>
      | <a href="#Conf">Conf</a> snr'' ms  &#x21D2
        <keyword>let</keyword>  [_ &#x22A2 MS] = <a href="#mstep_match">mstep_match</a> [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 N1] [_ &#x22A2 N2] ms <keyword>in</keyword> <a href="#Conf">Conf</a> (<a href="&sigma;nCasR">SnCasR</a> snr'' [_ &#x22A2 N1] [_ &#x22A2 N2]) [_ &#x22A2 MS]
    | [g &#x22A2 <a href="#rcinl">rcinl</a>] &#x21D2 <keyword>impossible</keyword> snr'
    | [g &#x22A2 <a href="#rcinr">rcinr</a>] &#x21D2 <keyword>impossible</keyword> snr'
    | [g &#x22A2 <a href="#rcl">rcl</a> (&lambda;x. S')] &#x21D2
      <keyword>let</keyword>  [_ &#x22A2 S'] : [g, x : <a href="#tm">tm</a> _ &#x22A2 <a href="#step">step</a> N1 N1']= [_ &#x22A2 S'] <keyword>in</keyword> 
      <keyword>let</keyword> snr'' = <a href="&sigma;nCasR">SnCasR</a> snr' [_ &#x22A2 N1'] [_ &#x22A2 N2] <keyword>in</keyword>
      <keyword>let</keyword>  snr' : <a href="&sigma;nRed">SnRed</a> [g &#x22A2 M] [g &#x22A2 M']= snr' <keyword>in</keyword> 
      <keyword>let</keyword> ms =
      <a href="#mstep_matchl">mstep_matchl</a> [_ &#x22A2 N1] [_ &#x22A2 N1'] [_ &#x22A2 M'] [_ &#x22A2 N2] [_ &#x22A2 <a href="#m-step">m-step</a> S' <a href="#m-refl">m-refl</a>] <keyword>in</keyword>
      <a href="#Conf">Conf</a> snr'' ms
    | [g &#x22A2 <a href="#rcr">rcr</a> (&lambda;y. S')] &#x21D2
      <keyword>let</keyword>  [_ &#x22A2 S'] : [g, x : <a href="#tm">tm</a> _ &#x22A2 <a href="#step">step</a> N2 N2']= [_ &#x22A2 S'] <keyword>in</keyword> 
      <keyword>let</keyword> snr'' = <a href="&sigma;nCasR">SnCasR</a> snr' [_ &#x22A2 N1] [_ &#x22A2 N2'] <keyword>in</keyword>
      <keyword>let</keyword>  snr' : <a href="&sigma;nRed">SnRed</a> [g &#x22A2 M] [g &#x22A2 M']= snr' <keyword>in</keyword> 
      <keyword>let</keyword> ms =
      <a href="#mstep_matchr">mstep_matchr</a> [_ &#x22A2 N2] [_ &#x22A2 N2'] [_ &#x22A2 M'] [_ &#x22A2 N1] [_ &#x22A2 <a href="#m-step">m-step</a> S' <a href="#m-refl">m-refl</a>] <keyword>in</keyword>
      <a href="#Conf">Conf</a> snr'' ms;
<br><keyword>rec</keyword> <span class="function" id="bc_aux_app">bc_aux_app</span> : {g : <a href="#cxt">cxt</a>} {A : [ &#x22A2 <a href="#ty">ty</a>]} {B : [ &#x22A2 <a href="#ty">ty</a>]} {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#arr">arr</a> A[] B[])]} {M' : [g &#x22A2 <a href="#tm">tm</a> (<a href="#arr">arr</a> A[] B[])]} {N : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;n">Sn</a> [g &#x22A2 M] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 N] &#x2192 <a href="&sigma;nRed">SnRed</a> [g &#x22A2 M] [g &#x22A2 M'] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#app">app</a> M' N] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#app">app</a> M N] / total {sn1 sn2} ( bc_aux_app g a b m m' n sn1 sn2 ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> A &#x21D2 <keyword>mlam</keyword> B &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> M' &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>fn</keyword> sn1 &#x21D2 <keyword>fn</keyword> sn2 &#x21D2 <keyword>fn</keyword> snr &#x21D2 <keyword>fn</keyword> sn &#x21D2 <a href="#Acc">Acc</a> [g] [ &#x22A2 B] [g &#x22A2 <a href="#app">app</a> M N] (<keyword>mlam</keyword> Q &#x21D2 <keyword>mlam</keyword> S &#x21D2 <keyword>case</keyword> [g &#x22A2 S] <keyword>of</keyword> 
  | [g &#x22A2 <a href="#rbeta">rbeta</a>] &#x21D2 <keyword>impossible</keyword> snr
  | [g &#x22A2 <a href="#rappl">rappl</a> S'] &#x21D2
    <keyword>let</keyword> conf = <a href="#confluence">confluence</a> [_ &#x22A2 M] [_ &#x22A2 M'] [_ &#x22A2 _] [_ &#x22A2 S'] snr <keyword>in</keyword>
    <keyword>case</keyword> conf <keyword>of</keyword> 
    | <a href="#Eq">Eq</a>  &#x21D2 sn
    | <a href="#Conf">Conf</a> snr' ms  &#x21D2
      <keyword>let</keyword> ms' = <a href="#mstep_appl">mstep_appl</a> [_ &#x22A2 M'] [_ &#x22A2 _] [_ &#x22A2 N] ms <keyword>in</keyword>
      <keyword>let</keyword> sn' = <a href="#mstep_sn">mstep_sn</a> [_ &#x22A2 <a href="#app">app</a> M' N] [_ &#x22A2 _] ms' sn <keyword>in</keyword>
      <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 <a href="#arr">arr</a> A B]) ([g &#x22A2 M]) r = sn1 <keyword>in</keyword> <a href="#bc_aux_app">bc_aux_app</a> [_] [ &#x22A2 _] [ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 N] (r [_ &#x22A2 _] [_ &#x22A2 S']) sn2 snr' sn'
  | [g &#x22A2 <a href="#rappr">rappr</a> S'] &#x21D2
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 B]) ([g &#x22A2 <a href="#app">app</a> M' N]) r = sn <keyword>in</keyword> 
    <keyword>let</keyword> sn' = r [_ &#x22A2 _] [_ &#x22A2 <a href="#rappr">rappr</a> S'] <keyword>in</keyword>
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 A]) ([g &#x22A2 N]) r' = sn2 <keyword>in</keyword> <a href="#bc_aux_app">bc_aux_app</a> [_] [ &#x22A2 _] [ &#x22A2 _] [_ &#x22A2 M] [_ &#x22A2 M'] [_ &#x22A2 _] sn1 (r' [_ &#x22A2 _] [_ &#x22A2 S']) snr sn');
<br><keyword>rec</keyword> <span class="function" id="bc_aux_sum">bc_aux_sum</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} {M' : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} {N1 : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {N2 : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} <a href="&sigma;n">Sn</a> [g &#x22A2 M] &#x2192 <a href="&sigma;n">Sn</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 N1] &#x2192 <a href="&sigma;n">Sn</a> [g, y : <a href="#tm">tm</a> B[] &#x22A2 N2] &#x2192 <a href="&sigma;nRed">SnRed</a> [g &#x22A2 M] [g &#x22A2 M'] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#match">match</a> M' (&lambda;x. N1) (&lambda;y. N2)] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)] / total {sn0 sn1 sn2} ( bc_aux_sum g a b c m m' n1 n2 sn0 sn1 sn2 ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> M' &#x21D2 <keyword>mlam</keyword> N1 &#x21D2 <keyword>mlam</keyword> N2 &#x21D2 <keyword>fn</keyword> sn0 &#x21D2 <keyword>fn</keyword> sn1 &#x21D2 <keyword>fn</keyword> sn2 &#x21D2 <keyword>fn</keyword> snr &#x21D2 <keyword>fn</keyword> sn' &#x21D2 
  <keyword>let</keyword>  [_ &#x22A2 N1] : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]= [_ &#x22A2 N1] <keyword>in</keyword> <a href="#Acc">Acc</a> [g] [ &#x22A2 C] [g &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)] (<keyword>mlam</keyword> Q &#x21D2 <keyword>mlam</keyword> S &#x21D2 <keyword>case</keyword> [g &#x22A2 S] <keyword>of</keyword> 
  | [g &#x22A2 <a href="#rcase">rcase</a> S'] &#x21D2
    <keyword>let</keyword> conf = <a href="#confluence">confluence</a> [_ &#x22A2 M] [_ &#x22A2 M'] [_ &#x22A2 _] [_ &#x22A2 S'] snr <keyword>in</keyword>
    <keyword>case</keyword> conf <keyword>of</keyword> 
    | <a href="#Eq">Eq</a>  &#x21D2 sn'
    | <a href="#Conf">Conf</a> snr' ms  &#x21D2
      <keyword>let</keyword>  [_ &#x22A2 MS] = <a href="#mstep_match">mstep_match</a> [_ &#x22A2 M'] [_ &#x22A2 _] [_ &#x22A2 N1] [_ &#x22A2 N2] ms <keyword>in</keyword> 
      <keyword>let</keyword> sn'' = <a href="#mstep_sn">mstep_sn</a> [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 MS] sn' <keyword>in</keyword>
      <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 _]) ([g &#x22A2 M]) r = sn0 <keyword>in</keyword> <a href="#bc_aux_sum">bc_aux_sum</a> [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 N1] [_ &#x22A2 N2] (r [_ &#x22A2 _] [_ &#x22A2 S']) sn1 sn2 snr' sn''
  | [g &#x22A2 <a href="#rcinl">rcinl</a>] &#x21D2 <keyword>impossible</keyword> snr
  | [g &#x22A2 <a href="#rcinr">rcinr</a>] &#x21D2 <keyword>impossible</keyword> snr
  | [g &#x22A2 <a href="#rcl">rcl</a> (&lambda;x. S')] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 S'] : [g, x : <a href="#tm">tm</a> _ &#x22A2 <a href="#step">step</a> N1 N1']= [_ &#x22A2 S'] <keyword>in</keyword> 
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 _]) ([g &#x22A2 _]) r = sn' <keyword>in</keyword> 
    <keyword>let</keyword> sn'' = r [g &#x22A2 <a href="#match">match</a> M' (&lambda;x. N1') (&lambda;y. N2)] [g &#x22A2 <a href="#rcl">rcl</a> (&lambda;x. S')] <keyword>in</keyword>
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g, x : <a href="#tm">tm</a> _]) ([ &#x22A2 C]) ([g, x : <a href="#tm">tm</a> _ &#x22A2 N1]) r' = sn1 <keyword>in</keyword> <a href="#bc_aux_sum">bc_aux_sum</a> [_ &#x22A2 M] [_ &#x22A2 M'] [_ &#x22A2 N1'] [_ &#x22A2 N2] sn0 (r' [_ &#x22A2 N1'] [_ &#x22A2 S']) sn2 snr sn''
  | [g &#x22A2 <a href="#rcr">rcr</a> (&lambda;y. S')] &#x21D2
    <keyword>let</keyword>  [_ &#x22A2 S'] : [g, y : <a href="#tm">tm</a> _ &#x22A2 <a href="#step">step</a> N2 N2']= [_ &#x22A2 S'] <keyword>in</keyword> 
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g]) ([ &#x22A2 _]) ([g &#x22A2 _]) r = sn' <keyword>in</keyword> 
    <keyword>let</keyword> sn'' = r [g &#x22A2 <a href="#match">match</a> M' (&lambda;x. N1) (&lambda;y. N2')] [g &#x22A2 <a href="#rcr">rcr</a> (&lambda;y. S')] <keyword>in</keyword>
    <keyword>let</keyword>  <a href="#Acc">Acc</a> ([g, y : <a href="#tm">tm</a> _]) ([ &#x22A2 C]) ([g, y : <a href="#tm">tm</a> _ &#x22A2 N2]) r' = sn2 <keyword>in</keyword> <a href="#bc_aux_sum">bc_aux_sum</a> [_ &#x22A2 M] [_ &#x22A2 M'] [_ &#x22A2 N1] [_ &#x22A2 N2'] sn0 sn1 (r' [_ &#x22A2 N2'] [_ &#x22A2 S']) snr sn'');
<br><keyword>rec</keyword> <span class="function" id="backwards_closure">backwards_closure</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} {M' : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;nRed">SnRed</a> [g &#x22A2 M] [g &#x22A2 M'] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 M'] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 M] / total r ( backwards_closure g a m m' r ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> M' &#x21D2 <keyword>fn</keyword> snr &#x21D2 <keyword>fn</keyword> sn &#x21D2 <keyword>case</keyword> snr <keyword>of</keyword> 
  | <a href="&sigma;nBeta">SnBeta</a> ([g, x : <a href="#tm">tm</a> A[] &#x22A2 M]) sn'  &#x21D2 <a href="#app_abs_sn">app_abs_sn</a> [_] [ &#x22A2 _] [ &#x22A2 _] [_ &#x22A2 M] [_ &#x22A2 _] sn sn'
  | <a href="&sigma;nAppl">SnAppl</a> r  &#x21D2
    <keyword>let</keyword> snl' = <a href="#app_sna">app_sna</a> [_ &#x22A2 _] [_ &#x22A2 _] sn <keyword>in</keyword>
    <keyword>let</keyword> snl = <a href="#backwards_closure">backwards_closure</a> [_ &#x22A2 _] [_ &#x22A2 _] r snl' <keyword>in</keyword>
    <keyword>let</keyword> snr = <a href="#app_snb">app_snb</a> [_ &#x22A2 _] [_ &#x22A2 _] sn <keyword>in</keyword>
    <a href="#bc_aux_app">bc_aux_app</a> [_] [ &#x22A2 _] [ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] snl snr r sn
  | <a href="&sigma;nCInl">SnCInl</a> sn0 sn1 sn2  &#x21D2 <a href="#casel_sn">casel_sn</a> [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] sn0 sn sn2
  | <a href="&sigma;nCInr">SnCInr</a> sn0 sn1 sn2  &#x21D2 <a href="#caser_sn">caser_sn</a> [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] sn0 sn1 sn
  | <a href="&sigma;nCasR">SnCasR</a> snr' ([g, x : <a href="#tm">tm</a> A[] &#x22A2 N1]) ([g, y : <a href="#tm">tm</a> B[] &#x22A2 N2])  &#x21D2
    <keyword>let</keyword> sn' = <a href="#case_sna">case_sna</a> [_ &#x22A2 _] [_ &#x22A2 N1] [_ &#x22A2 N2] sn <keyword>in</keyword>
    <keyword>let</keyword> sn0 = <a href="#backwards_closure">backwards_closure</a> [_ &#x22A2 _] [_ &#x22A2 _] snr' sn' <keyword>in</keyword>
    <keyword>let</keyword> sn1 = <a href="#case_snb">case_snb</a> [_ &#x22A2 _] [_ &#x22A2 N1] [_ &#x22A2 N2] sn <keyword>in</keyword>
    <keyword>let</keyword> sn2 = <a href="#case_snc">case_snc</a> [_ &#x22A2 _] [_ &#x22A2 N1] [_ &#x22A2 N2] sn <keyword>in</keyword>
    <a href="#bc_aux_sum">bc_aux_sum</a> [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] sn0 sn1 sn2 snr' sn;
<br><keyword>rec</keyword> <span class="function" id="neutralSNe">neutralSNe</span> : (g:<a href="#cxt">cxt</a>) {R : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;Ne">SNe</a> [g &#x22A2 R] &#x2192 <a href="#Neutral">Neutral</a> [g &#x22A2 R] / total sne ( neutralSNe g a r sne ) / =
<keyword>mlam</keyword> R &#x21D2 <keyword>fn</keyword> sne &#x21D2 <keyword>case</keyword> sne <keyword>of</keyword> 
  | <a href="&sigma;Var">SVar</a> ([g &#x22A2 #p])  &#x21D2 <a href="#Nvar">Nvar</a> [g &#x22A2 #p]
  | <a href="&sigma;App">SApp</a> sne' sn  &#x21D2
    <keyword>let</keyword> neu = <a href="#neutralSNe">neutralSNe</a> [_ &#x22A2 _] sne' <keyword>in</keyword> <a href="#Napp">Napp</a> [_ &#x22A2 _] [_ &#x22A2 _] neu
  | <a href="&sigma;Case">SCase</a> sne' sn1 sn2  &#x21D2
    <keyword>let</keyword> neu = <a href="#neutralSNe">neutralSNe</a> [_ &#x22A2 _] sne' <keyword>in</keyword>
    <keyword>let</keyword>  sn1 : <a href="&sigma;N">SN</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 N1]= sn1 <keyword>in</keyword> 
    <keyword>let</keyword>  sn2 : <a href="&sigma;N">SN</a> [g, x : <a href="#tm">tm</a> B[] &#x22A2 N2]= sn2 <keyword>in</keyword> <a href="#Ncase">Ncase</a> [_ &#x22A2 _] [_ &#x22A2 N1] [_ &#x22A2 N2] neu;
<br><keyword>rec</keyword> <span class="function" id="soundSN">soundSN</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;N">SN</a> [g &#x22A2 M] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 M] / total s ( soundSN g a m s ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>fn</keyword> sn &#x21D2 <keyword>case</keyword> sn <keyword>of</keyword> 
  | <a href="&sigma;Neu">SNeu</a> sne  &#x21D2 soundSNe [_ &#x22A2 M] sne
  | <a href="&sigma;Abs">SAbs</a> sn'  &#x21D2
    <keyword>let</keyword> sn'' = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] sn' <keyword>in</keyword> <a href="#abs_sn">abs_sn</a> [_] [ &#x22A2 _] [ &#x22A2 _] [_ &#x22A2 _] sn''
  | <a href="&sigma;Red">SRed</a> snr sn'  &#x21D2
    <keyword>let</keyword> snr' = soundSNRed [_ &#x22A2 _] [_ &#x22A2 _] snr <keyword>in</keyword>
    <keyword>let</keyword> sn'' = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] sn' <keyword>in</keyword> <a href="#backwards_closure">backwards_closure</a> [_ &#x22A2 M] [_ &#x22A2 _] snr' sn''
  | <a href="&sigma;Inl">SInl</a> sn'  &#x21D2
    <keyword>let</keyword> sn'' = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] sn' <keyword>in</keyword> <a href="#inl_sn">inl_sn</a> [_ &#x22A2 _] [ &#x22A2 _] sn''
  | <a href="&sigma;Inr">SInr</a> sn'  &#x21D2
    <keyword>let</keyword> sn'' = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] sn' <keyword>in</keyword> <a href="#inr_sn">inr_sn</a> [_ &#x22A2 _] [ &#x22A2 _] sn''
<keyword>and</keyword> <span class="function" id="soundSNe">soundSNe</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;Ne">SNe</a> [g &#x22A2 M] &#x2192 <a href="&sigma;n">Sn</a> [g &#x22A2 M] / total s ( soundSNe g a m s ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>fn</keyword> sne &#x21D2 <keyword>case</keyword> sne <keyword>of</keyword> 
  | <a href="&sigma;Var">SVar</a> ([g &#x22A2 #p])  &#x21D2 <a href="#varSn">varSn</a> [g &#x22A2 #p]
  | <a href="&sigma;App">SApp</a> sne' sn  &#x21D2
    <keyword>let</keyword> snl = <a href="#soundSNe">soundSNe</a> [_ &#x22A2 _] sne' <keyword>in</keyword>
    <keyword>let</keyword> snr = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] sn <keyword>in</keyword>
    <keyword>let</keyword> neu = <a href="#neutralSNe">neutralSNe</a> [_ &#x22A2 _] sne' <keyword>in</keyword>
    <a href="#app_sn">app_sn</a> [_] [ &#x22A2 _] [ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] neu snl snr
  | <a href="&sigma;Case">SCase</a> sne' snl snr  &#x21D2
    <keyword>let</keyword> neu = <a href="#neutralSNe">neutralSNe</a> [_ &#x22A2 _] sne' <keyword>in</keyword>
    <keyword>let</keyword> sn0 = <a href="#soundSNe">soundSNe</a> [_ &#x22A2 _] sne' <keyword>in</keyword>
    <keyword>let</keyword> sn1 = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] snl <keyword>in</keyword>
    <keyword>let</keyword> sn2 = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] snr <keyword>in</keyword> <a href="#match_sn">match_sn</a> [_ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] neu sn0 sn1 sn2
<keyword>and</keyword> <span class="function" id="soundSNRed">soundSNRed</span> : (g:<a href="#cxt">cxt</a>) {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} {M' : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;NRed">SNRed</a> [g &#x22A2 M] [g &#x22A2 M'] &#x2192 <a href="&sigma;nRed">SnRed</a> [g &#x22A2 M] [g &#x22A2 M'] / total s ( soundSNRed g a m m' s ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> M' &#x21D2 <keyword>fn</keyword> snr &#x21D2 <keyword>case</keyword> snr <keyword>of</keyword> 
  | <a href="&sigma;Beta">SBeta</a> ([g, x : <a href="#tm">tm</a> A[] &#x22A2 M]) sn  &#x21D2
    <keyword>let</keyword> sn' = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] sn <keyword>in</keyword> <a href="&sigma;nBeta">SnBeta</a> [_ &#x22A2 M] sn'
  | <a href="&sigma;Appl">SAppl</a> snr'  &#x21D2
    <keyword>let</keyword> snr'' = <a href="#soundSNRed">soundSNRed</a> [_ &#x22A2 _] [_ &#x22A2 _] snr' <keyword>in</keyword> <a href="&sigma;nAppl">SnAppl</a> snr''
  | <a href="&sigma;CInl">SCInl</a> sn0 sn1 sn2  &#x21D2
    <keyword>let</keyword> sn0' = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] sn0 <keyword>in</keyword>
    <keyword>let</keyword> sn1' = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] sn1 <keyword>in</keyword>
    <keyword>let</keyword> sn2' = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] sn2 <keyword>in</keyword> <a href="&sigma;nCInl">SnCInl</a> sn0' sn1' sn2'
  | <a href="&sigma;CInr">SCInr</a> sn0 sn1 sn2  &#x21D2
    <keyword>let</keyword> sn0' = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] sn0 <keyword>in</keyword>
    <keyword>let</keyword> sn1' = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] sn1 <keyword>in</keyword>
    <keyword>let</keyword> sn2' = <a href="#soundSN">soundSN</a> [_ &#x22A2 _] sn2 <keyword>in</keyword> <a href="&sigma;nCInr">SnCInr</a> sn0' sn1' sn2'
  | <a href="&sigma;RCase">SRCase</a> snr' ([g, x : <a href="#tm">tm</a> A[] &#x22A2 N1]) ([g, y : <a href="#tm">tm</a> B[] &#x22A2 N2])  &#x21D2
    <keyword>let</keyword> snr'' = <a href="#soundSNRed">soundSNRed</a> [_ &#x22A2 _] [_ &#x22A2 _] snr' <keyword>in</keyword> <a href="&sigma;nCasR">SnCasR</a> snr'' [_ &#x22A2 N1] [_ &#x22A2 N2];
<br><keyword>rec</keyword> <span class="function" id="renameSN">renameSN</span> : {g : <a href="#cxt">cxt</a>} {g' : <a href="#cxt">cxt</a>} [g' &#x22A2 g] {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;N">SN</a> [g &#x22A2 M] &#x2192 <a href="&sigma;N">SN</a> [g' &#x22A2 M[#R]] / total s ( renameSN g g' a r m s ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> g' &#x21D2 <keyword>mlam</keyword> R &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>fn</keyword> s &#x21D2 <keyword>case</keyword> s <keyword>of</keyword> 
  | <a href="&sigma;Neu">SNeu</a> s'  &#x21D2 <a href="&sigma;Neu">SNeu</a> (renameSNe [g' &#x22A2 #R] [g &#x22A2 M] s')
  | <a href="&sigma;Abs">SAbs</a> s'  &#x21D2
    <a href="&sigma;Abs">SAbs</a> (<a href="#renameSN">renameSN</a> [g, x : <a href="#tm">tm</a> _] [g', x : <a href="#tm">tm</a> _] [g', x : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], x] [g, x : <a href="#tm">tm</a> _ &#x22A2 _] s')
  | <a href="&sigma;Red">SRed</a> r s'  &#x21D2 <a href="&sigma;Red">SRed</a> (renameSNRed [g' &#x22A2 #R] [g &#x22A2 M] r) (<a href="#renameSN">renameSN</a> [g] [g'] [g' &#x22A2 #R] [g &#x22A2 _] s')
  | <a href="&sigma;Inl">SInl</a> s'  &#x21D2 <a href="&sigma;Inl">SInl</a> (<a href="#renameSN">renameSN</a> [g] [g'] [g' &#x22A2 #R] [g &#x22A2 _] s')
  | <a href="&sigma;Inr">SInr</a> s'  &#x21D2 <a href="&sigma;Inr">SInr</a> (<a href="#renameSN">renameSN</a> [g] [g'] [g' &#x22A2 #R] [g &#x22A2 _] s')
<keyword>and</keyword> <span class="function" id="renameSNe">renameSNe</span> : (g:<a href="#cxt">cxt</a>) (g':<a href="#cxt">cxt</a>) [g' &#x22A2 g] {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;Ne">SNe</a> [g &#x22A2 M] &#x2192 <a href="&sigma;Ne">SNe</a> [g' &#x22A2 M[#R]] / total s ( renameSNe g g' a r m s ) / =
<keyword>mlam</keyword> R &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>fn</keyword> s &#x21D2 <keyword>case</keyword> s <keyword>of</keyword> 
  | <a href="&sigma;Var">SVar</a> ([g &#x22A2 #p])  &#x21D2 <a href="&sigma;Var">SVar</a> [_ &#x22A2 #p[#R]]
  | <a href="&sigma;App">SApp</a> s1 s2  &#x21D2
    <a href="&sigma;App">SApp</a> (<a href="#renameSNe">renameSNe</a> [_ &#x22A2 #R] [_ &#x22A2 _] s1) (<a href="#renameSN">renameSN</a> [_] [_] [_ &#x22A2 #R] [_ &#x22A2 _] s2)
  | <a href="&sigma;Case">SCase</a> s1 s2 s3  &#x21D2
    <a href="&sigma;Case">SCase</a> (<a href="#renameSNe">renameSNe</a> [_ &#x22A2 #R] [_ &#x22A2 _] s1) (<a href="#renameSN">renameSN</a> [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], x] [_, x : <a href="#tm">tm</a> _ &#x22A2 _] s2) (<a href="#renameSN">renameSN</a> [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], y] [_, y : <a href="#tm">tm</a> _ &#x22A2 _] s3)
<keyword>and</keyword> <span class="function" id="renameSNRed">renameSNRed</span> : (g:<a href="#cxt">cxt</a>) (g':<a href="#cxt">cxt</a>) [g' &#x22A2 g] {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;NRed">SNRed</a> [g &#x22A2 M] [g &#x22A2 N] &#x2192 <a href="&sigma;NRed">SNRed</a> [g' &#x22A2 M[#R]] [g' &#x22A2 N[#R]] / total s ( renameSNRed g g' a r m s ) / =
<keyword>mlam</keyword> R &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>fn</keyword> s &#x21D2 <keyword>case</keyword> s <keyword>of</keyword> 
  | <a href="&sigma;Beta">SBeta</a> ([g, x : <a href="#tm">tm</a> A[] &#x22A2 M]) s'  &#x21D2
    <a href="&sigma;Beta">SBeta</a> [_, x : <a href="#tm">tm</a> A[] &#x22A2 M[#R[&hellip;], x]] (<a href="#renameSN">renameSN</a> [_] [_] [_ &#x22A2 #R] [_ &#x22A2 _] s')
  | <a href="&sigma;Appl">SAppl</a> s'  &#x21D2 <a href="&sigma;Appl">SAppl</a> (<a href="#renameSNRed">renameSNRed</a> [_ &#x22A2 #R] [_ &#x22A2 _] s')
  | <a href="&sigma;CInl">SCInl</a> s' n1 n2  &#x21D2
    <a href="&sigma;CInl">SCInl</a> (<a href="#renameSN">renameSN</a> [_] [_] [_ &#x22A2 #R] [_ &#x22A2 _] s') (<a href="#renameSN">renameSN</a> [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], x] [_, x : <a href="#tm">tm</a> _ &#x22A2 _] n1) (<a href="#renameSN">renameSN</a> [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], y] [_, y : <a href="#tm">tm</a> _ &#x22A2 _] n2)
  | <a href="&sigma;CInr">SCInr</a> s' n1 n2  &#x21D2
    <a href="&sigma;CInr">SCInr</a> (<a href="#renameSN">renameSN</a> [_] [_] [_ &#x22A2 #R] [_ &#x22A2 _] s') (<a href="#renameSN">renameSN</a> [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], x] [_, x : <a href="#tm">tm</a> _ &#x22A2 _] n1) (<a href="#renameSN">renameSN</a> [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], y] [_, y : <a href="#tm">tm</a> _ &#x22A2 _] n2)
  | <a href="&sigma;RCase">SRCase</a> s' ([g, x : <a href="#tm">tm</a> A[] &#x22A2 N1]) ([g, y : <a href="#tm">tm</a> B[] &#x22A2 N2])  &#x21D2
    <a href="&sigma;RCase">SRCase</a> (<a href="#renameSNRed">renameSNRed</a> [_ &#x22A2 #R] [_ &#x22A2 _] s') [_, x : <a href="#tm">tm</a> A[] &#x22A2 N1[#R[&hellip;], x]] [_, y : <a href="#tm">tm</a> B[] &#x22A2 N2[#R[&hellip;], y]];
<br><keyword>inductive</keyword> <span class="typ" id="SNRed'">SNRed'</span> : {g : <a href="#cxt">cxt</a>} &#x2192 {g' : <a href="#cxt">cxt</a>} &#x2192 [g' &#x22A2 g] &#x2192 {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 {M' : [g' &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 <keyword>ctype</keyword> = 
| <span class="constructor" id="SNRed'">SNRed'</span> : {g' : <a href="#cxt">cxt</a>} {g : <a href="#cxt">cxt</a>} {N : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;NRed">SNRed</a> [g &#x22A2 M] [g &#x22A2 N] &#x2192 <a href="&sigma;NRed'">SNRed'</a> [g' &#x22A2 #R] [g &#x22A2 M] [g' &#x22A2 N[#R]];
<br><keyword>rec</keyword> <span class="function" id="anti_renameSNe">anti_renameSNe</span> : (g:<a href="#cxt">cxt</a>) (g':<a href="#cxt">cxt</a>) [g' &#x22A2 g] {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;Ne">SNe</a> [g' &#x22A2 M[#R]] &#x2192 <a href="&sigma;Ne">SNe</a> [g &#x22A2 M] / total s ( anti_renameSNe g g' a r m s ) / =
<keyword>mlam</keyword> R &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>fn</keyword> s &#x21D2 <keyword>case</keyword> s <keyword>of</keyword> 
  | <a href="&sigma;Var">SVar</a> ([h' &#x22A2 _])  &#x21D2 <a href="&sigma;Var">SVar</a> [_ &#x22A2 _]
  | <a href="&sigma;App">SApp</a> r s  &#x21D2
    <keyword>let</keyword> r' = <a href="#anti_renameSNe">anti_renameSNe</a> [_ &#x22A2 #R] [_ &#x22A2 _] r <keyword>in</keyword>
    <keyword>let</keyword> s' = anti_renameSN [_] [_] [_ &#x22A2 #R] [_ &#x22A2 _] s <keyword>in</keyword> <a href="&sigma;App">SApp</a> r' s'
  | <a href="&sigma;Case">SCase</a> s1 s2 s3  &#x21D2
    <keyword>let</keyword> s1' = <a href="#anti_renameSNe">anti_renameSNe</a> [_ &#x22A2 #R] [_ &#x22A2 _] s1 <keyword>in</keyword>
    <keyword>let</keyword> s2' =
    anti_renameSN [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], x] [_ &#x22A2 _] s2 <keyword>in</keyword>
    <keyword>let</keyword> s3' =
    anti_renameSN [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], y] [_ &#x22A2 _] s3 <keyword>in</keyword>
    <a href="&sigma;Case">SCase</a> s1' s2' s3'<keyword>and</keyword> <span class="function" id="anti_renameSNRed">anti_renameSNRed</span> : {g : <a href="#cxt">cxt</a>} {g' : <a href="#cxt">cxt</a>} [g' &#x22A2 g] {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;NRed">SNRed</a> [g' &#x22A2 M[#R]] [g' &#x22A2 N'] &#x2192 <a href="&sigma;NRed'">SNRed'</a> [g' &#x22A2 #R] [g &#x22A2 M] [g' &#x22A2 N'] / total s ( anti_renameSNRed g g' a r m s ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> g' &#x21D2 <keyword>mlam</keyword> R &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>fn</keyword> r &#x21D2 <keyword>case</keyword> r <keyword>of</keyword> 
  | <a href="&sigma;Beta">SBeta</a> ([_ &#x22A2 _]) s  &#x21D2
    <keyword>let</keyword> s' = anti_renameSN [g] [g'] [g' &#x22A2 #R] [_ &#x22A2 _] s <keyword>in</keyword>
    <a href="&sigma;NRed'">SNRed'</a> [_] [_] [_ &#x22A2 _] (<a href="&sigma;Beta">SBeta</a> [_ &#x22A2 _] s')
  | <a href="&sigma;Appl">SAppl</a> r'  &#x21D2
    <keyword>let</keyword>  <a href="&sigma;NRed'">SNRed'</a> ([_]) ([_]) ([_ &#x22A2 _]) r0 =
    <a href="#anti_renameSNRed">anti_renameSNRed</a> [g] [g'] [g' &#x22A2 #R] [_ &#x22A2 _] r' <keyword>in</keyword> <a href="&sigma;NRed'">SNRed'</a> [_] [_] [_ &#x22A2 _] (<a href="&sigma;Appl">SAppl</a> r0)
  | <a href="&sigma;CInl">SCInl</a> s n1 n2  &#x21D2
    <keyword>let</keyword> s' = anti_renameSN [_] [_] [_ &#x22A2 #R] [_ &#x22A2 _] s <keyword>in</keyword>
    <keyword>let</keyword> s1 = anti_renameSN [g, x : <a href="#tm">tm</a> _] [_] [g', x : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], x] [_ &#x22A2 _] n1 <keyword>in</keyword>
    <keyword>let</keyword> s2 = anti_renameSN [g, y : <a href="#tm">tm</a> _] [_] [g', y : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], y] [_ &#x22A2 _] n2 <keyword>in</keyword>
    <a href="&sigma;NRed'">SNRed'</a> [_] [_] [_ &#x22A2 _] (<a href="&sigma;CInl">SCInl</a> s' s1 s2)
  | <a href="&sigma;CInr">SCInr</a> s n1 n2  &#x21D2
    <keyword>let</keyword> s' = anti_renameSN [_] [_] [_ &#x22A2 #R] [_ &#x22A2 _] s <keyword>in</keyword>
    <keyword>let</keyword> s1 = anti_renameSN [g, x : <a href="#tm">tm</a> _] [_] [g', x : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], x] [_ &#x22A2 _] n1 <keyword>in</keyword>
    <keyword>let</keyword> s2 = anti_renameSN [g, y : <a href="#tm">tm</a> _] [_] [g', y : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], y] [_ &#x22A2 _] n2 <keyword>in</keyword>
    <a href="&sigma;NRed'">SNRed'</a> [_] [_] [_ &#x22A2 _] (<a href="&sigma;CInr">SCInr</a> s' s1 s2)
  | <a href="&sigma;RCase">SRCase</a> s ([g', x : <a href="#tm">tm</a> _ &#x22A2 _]) ([g', y : <a href="#tm">tm</a> _ &#x22A2 _])  &#x21D2
    <keyword>let</keyword>  <a href="&sigma;NRed'">SNRed'</a> ([_]) ([_]) ([_ &#x22A2 _]) s' = <a href="#anti_renameSNRed">anti_renameSNRed</a> [_] [_] [_ &#x22A2 #R] [_ &#x22A2 _] s <keyword>in</keyword> <a href="&sigma;NRed'">SNRed'</a> [_] [_] [_ &#x22A2 _] (<a href="&sigma;RCase">SRCase</a> s' [g, x : <a href="#tm">tm</a> _ &#x22A2 _] [g, y : <a href="#tm">tm</a> _ &#x22A2 _])
<keyword>and</keyword> <span class="function" id="anti_renameSN">anti_renameSN</span> : {g : <a href="#cxt">cxt</a>} {g' : <a href="#cxt">cxt</a>} [g' &#x22A2 g] {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;N">SN</a> [g' &#x22A2 M[#R]] &#x2192 <a href="&sigma;N">SN</a> [g &#x22A2 M] / total s ( anti_renameSN g g' a r m s ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> g' &#x21D2 <keyword>mlam</keyword> R &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>fn</keyword> s &#x21D2 <keyword>case</keyword> s <keyword>of</keyword> 
  | <a href="&sigma;Abs">SAbs</a> s'  &#x21D2
    <a href="&sigma;Abs">SAbs</a> (<a href="#anti_renameSN">anti_renameSN</a> [g, x : <a href="#tm">tm</a> _] [g', x : <a href="#tm">tm</a> _] [g', x : <a href="#tm">tm</a> _ &#x22A2 #R[&hellip;], x] [g, x : <a href="#tm">tm</a> _ &#x22A2 _] s')
  | <a href="&sigma;Neu">SNeu</a> s'  &#x21D2 <a href="&sigma;Neu">SNeu</a> (<a href="#anti_renameSNe">anti_renameSNe</a> [g' &#x22A2 #R] [g &#x22A2 M] s')
  | <a href="&sigma;Red">SRed</a> r' s'  &#x21D2
    <keyword>let</keyword>  <a href="&sigma;NRed'">SNRed'</a> ([g']) ([g]) ([g &#x22A2 N]) r =
    <a href="#anti_renameSNRed">anti_renameSNRed</a> [_] [_] [g' &#x22A2 #R] [_ &#x22A2 _] r' <keyword>in</keyword> 
    <keyword>let</keyword> s'' = <a href="#anti_renameSN">anti_renameSN</a> [g] [g'] [g' &#x22A2 #R] [g &#x22A2 N] s' <keyword>in</keyword> <a href="&sigma;Red">SRed</a> r s''
  | <a href="&sigma;Inl">SInl</a> s'  &#x21D2 <a href="&sigma;Inl">SInl</a> (<a href="#anti_renameSN">anti_renameSN</a> [_] [_] [_ &#x22A2 #R] [_ &#x22A2 _] s')
  | <a href="&sigma;Inr">SInr</a> s'  &#x21D2 <a href="&sigma;Inr">SInr</a> (<a href="#anti_renameSN">anti_renameSN</a> [_] [_] [_ &#x22A2 #R] [_ &#x22A2 _] s');
<br><keyword>rec</keyword> <span class="function" id="ext_SN">ext_SN</span> : {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#arr">arr</a> A[] B[])]} {#p : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;N">SN</a> [g &#x22A2 <a href="#app">app</a> M (#p)] &#x2192 <a href="&sigma;N">SN</a> [g &#x22A2 M] / total s ( ext_SN g a b m p s ) / =
<keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> p &#x21D2 <keyword>fn</keyword> s &#x21D2 <keyword>case</keyword> s <keyword>of</keyword> 
  | <a href="&sigma;Neu">SNeu</a> (<a href="&sigma;App">SApp</a> sm sv )  &#x21D2 <a href="&sigma;Neu">SNeu</a> sm
  | <a href="&sigma;Red">SRed</a> r sm'  &#x21D2
    <keyword>case</keyword> r <keyword>of</keyword> 
    | <a href="&sigma;Beta">SBeta</a> ([g, x : <a href="#tm">tm</a> A[] &#x22A2 M']) sn  &#x21D2
      <keyword>let</keyword> sn' =
      <a href="#anti_renameSN">anti_renameSN</a> [g, x : <a href="#tm">tm</a> A[]] [g] [g &#x22A2 &hellip;, (#p[&hellip;])] [g, x : <a href="#tm">tm</a> A[] &#x22A2 M'] sm' <keyword>in</keyword>
      <a href="&sigma;Abs">SAbs</a> sn'
    | <a href="&sigma;Appl">SAppl</a> r'  &#x21D2 <keyword>let</keyword> sn = <a href="#ext_SN">ext_SN</a> [_ &#x22A2 _] [_ &#x22A2 #p] sm' <keyword>in</keyword> <a href="&sigma;Red">SRed</a> r' sn;
<br><keyword>inductive</keyword> <span class="typ" id="Eq">Eq</span> : {g : <a href="#cxt">cxt</a>} &#x2192 {y2892 : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 {z2891 : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 <keyword>ctype</keyword> = 
| <span class="constructor" id="Refl">Refl</span> : <a href="#Eq">Eq</a> [g &#x22A2 M] [g &#x22A2 M];
<br><keyword>inductive</keyword> <span class="typ" id="Red">Red</span> : {A : [ &#x22A2 <a href="#ty">ty</a>]} &#x2192 {g : <a href="#cxt">cxt</a>} &#x2192 {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} &#x2192 <keyword>ctype</keyword> = 
| <span class="constructor" id="RBase">RBase</span> : <a href="&sigma;N">SN</a> [g &#x22A2 M] &#x2192 <a href="#Red">Red</a> [ &#x22A2 <a href="#base">base</a>] [g &#x22A2 M]
| <span class="constructor" id="RArr">RArr</span> : ({g' : <a href="#cxt">cxt</a>} [g' &#x22A2 g] {N : [g' &#x22A2 <a href="#tm">tm</a> A[]]} <a href="#Red">Red</a> [ &#x22A2 A] [g' &#x22A2 N] &#x2192 <a href="#Red">Red</a> [ &#x22A2 B] [g' &#x22A2 <a href="#app">app</a> M[&sigma;] N]) &#x2192 <a href="#Red">Red</a> [ &#x22A2 <a href="#arr">arr</a> A B] [g &#x22A2 M]
| <span class="constructor" id="RSum">RSum</span> : <a href="#DSClosure">DSClosure</a> [g &#x22A2 M] &#x2192 <a href="#Red">Red</a> [ &#x22A2 <a href="#sum">sum</a> A B] [g &#x22A2 M]
<keyword>and</keyword> <keyword>inductive</keyword> <span class="typ" id="DSClosure">DSClosure</span> : {g : <a href="#cxt">cxt</a>} &#x2192 {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} &#x2192 <keyword>ctype</keyword> = 
| <span class="constructor" id="DSLeft">DSLeft</span> : <a href="#Red">Red</a> [ &#x22A2 A] [g &#x22A2 N] &#x2192 <a href="#Eq">Eq</a> [g &#x22A2 <a href="#inl">inl</a> B[] N] [g &#x22A2 M] &#x2192 <a href="#DSClosure">DSClosure</a> [g &#x22A2 M]
| <span class="constructor" id="DSRight">DSRight</span> : <a href="#Red">Red</a> [ &#x22A2 B] [g &#x22A2 N] &#x2192 <a href="#Eq">Eq</a> [g &#x22A2 <a href="#inr">inr</a> A[] N] [g &#x22A2 M] &#x2192 <a href="#DSClosure">DSClosure</a> [g &#x22A2 M]
| <span class="constructor" id="DSSNe">DSSNe</span> : <a href="&sigma;Ne">SNe</a> [g &#x22A2 M] &#x2192 <a href="#DSClosure">DSClosure</a> [g &#x22A2 M]
| <span class="constructor" id="DSRed">DSRed</span> : <a href="#DSClosure">DSClosure</a> [g &#x22A2 M] &#x2192 <a href="&sigma;NRed">SNRed</a> [g &#x22A2 N] [g &#x22A2 M] &#x2192 <a href="#DSClosure">DSClosure</a> [g &#x22A2 N];
<br><keyword>inductive</keyword> <span class="typ" id="RedS">RedS</span> : {g : <a href="#cxt">cxt</a>} &#x2192 {g' : <a href="#cxt">cxt</a>} &#x2192 [g' &#x22A2 g] &#x2192 <keyword>ctype</keyword> = 
| <span class="constructor" id="RNil">RNil</span> : <a href="#RedS">RedS</a> [] [g' &#x22A2 ^]
| <span class="constructor" id="RCons">RCons</span> : <a href="#Red">Red</a> [ &#x22A2 A] [g' &#x22A2 M] &#x2192 <a href="#RedS">RedS</a> [g] [g' &#x22A2 &sigma;] &#x2192 <a href="#RedS">RedS</a> [g, x : <a href="#tm">tm</a> A[]] [g' &#x22A2 &sigma;, M];
<br><keyword>rec</keyword> <span class="function" id="rename_red">rename_red</span> : {g : <a href="#cxt">cxt</a>} {g' : <a href="#cxt">cxt</a>} {A : [ &#x22A2 <a href="#ty">ty</a>]} {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} [g' &#x22A2 g] <a href="#Red">Red</a> [ &#x22A2 A] [g &#x22A2 M] &#x2192 <a href="#Red">Red</a> [ &#x22A2 A] [g' &#x22A2 M[#R]] / total a ( rename_red g g' a ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> g' &#x21D2 <keyword>mlam</keyword> A &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> R &#x21D2 <keyword>fn</keyword> r &#x21D2 <keyword>case</keyword> [ &#x22A2 A] <keyword>of</keyword> 
  | [ &#x22A2 <a href="#base">base</a>] &#x21D2
    <keyword>let</keyword>  <a href="#RBase">RBase</a> s = r <keyword>in</keyword> <a href="#RBase">RBase</a> (<a href="#renameSN">renameSN</a> [_] [_] [g' &#x22A2 #R] [g &#x22A2 M] s)
  | [ &#x22A2 <a href="#arr">arr</a> A B] &#x21D2
    <keyword>let</keyword>  <a href="#RArr">RArr</a> r' = r <keyword>in</keyword> <a href="#RArr">RArr</a> (<keyword>mlam</keyword> g'' &#x21D2 <keyword>mlam</keyword> S &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>fn</keyword> rn &#x21D2 r' [g''] [g'' &#x22A2 #R[&sigma;[&hellip;]]] [g'' &#x22A2 N] rn)
  | [ &#x22A2 <a href="#sum">sum</a> A B] &#x21D2
    <keyword>let</keyword>  <a href="#RSum">RSum</a> d = r <keyword>in</keyword> <a href="#RSum">RSum</a> (rename_DS [g] [g'] [ &#x22A2 _] [ &#x22A2 _] [_ &#x22A2 _] [g' &#x22A2 #R] d)
<keyword>and</keyword> <span class="function" id="rename_DS">rename_DS</span> : {g : <a href="#cxt">cxt</a>} {g' : <a href="#cxt">cxt</a>} {A : [ &#x22A2 <a href="#ty">ty</a>]} {B : [ &#x22A2 <a href="#ty">ty</a>]} {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} [g' &#x22A2 g] <a href="#DSClosure">DSClosure</a> [g &#x22A2 M] &#x2192 <a href="#DSClosure">DSClosure</a> [g' &#x22A2 M[#R]] / total d ( rename_DS g g' a b m r d ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> g' &#x21D2 <keyword>mlam</keyword> A &#x21D2 <keyword>mlam</keyword> B &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> R &#x21D2 <keyword>fn</keyword> d &#x21D2 <keyword>case</keyword> d <keyword>of</keyword> 
  | <a href="#DSLeft">DSLeft</a> r' (<a href="#Refl">Refl</a> )  &#x21D2
    <a href="#DSLeft">DSLeft</a> (<a href="#rename_red">rename_red</a> [g] [g'] [ &#x22A2 _] [_ &#x22A2 _] [g' &#x22A2 #R] r') <a href="#Refl">Refl</a>
  | <a href="#DSRight">DSRight</a> r' (<a href="#Refl">Refl</a> )  &#x21D2
    <a href="#DSRight">DSRight</a> (<a href="#rename_red">rename_red</a> [g] [g'] [ &#x22A2 _] [_ &#x22A2 _] [g' &#x22A2 #R] r') <a href="#Refl">Refl</a>
  | <a href="#DSSNe">DSSNe</a> sne  &#x21D2 <a href="#DSSNe">DSSNe</a> (<a href="#renameSNe">renameSNe</a> [_ &#x22A2 #R] [_ &#x22A2 _] sne)
  | <a href="#DSRed">DSRed</a> d' r'  &#x21D2
    <keyword>let</keyword> d'' = <a href="#rename_DS">rename_DS</a> [g] [g'] [ &#x22A2 _] [ &#x22A2 _] [_ &#x22A2 _] [g' &#x22A2 #R] d' <keyword>in</keyword>
    <a href="#DSRed">DSRed</a> d'' (<a href="#renameSNRed">renameSNRed</a> [_ &#x22A2 #R] [_ &#x22A2 _] r')
<keyword>and</keyword> <span class="function" id="rename_redS">rename_redS</span> : {g : <a href="#cxt">cxt</a>} {g' : <a href="#cxt">cxt</a>} [g' &#x22A2 g] <a href="#RedS">RedS</a> [h] [g &#x22A2 &sigma;] &#x2192 <a href="#RedS">RedS</a> [h] [g' &#x22A2 &sigma;[#R]] / total rs ( rename_redS g g' s rs ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> g' &#x21D2 <keyword>mlam</keyword> R &#x21D2 <keyword>fn</keyword> rs &#x21D2 <keyword>case</keyword> rs <keyword>of</keyword> 
  | <a href="#RNil">RNil</a>  &#x21D2 <a href="#RNil">RNil</a>
  | <a href="#RCons">RCons</a> r rs'  &#x21D2
    <a href="#RCons">RCons</a> (<a href="#rename_red">rename_red</a> [g] [g'] [ &#x22A2 _] [_ &#x22A2 _] [g' &#x22A2 #R] r) (<a href="#rename_redS">rename_redS</a> [g] [g'] [g' &#x22A2 #R] rs');
<br><keyword>rec</keyword> <span class="function" id="cr1">cr1</span> : {g : <a href="#cxt">cxt</a>} {A : [ &#x22A2 <a href="#ty">ty</a>]} {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="#Red">Red</a> [ &#x22A2 A] [g &#x22A2 M] &#x2192 <a href="&sigma;N">SN</a> [g &#x22A2 M] / total a ( cr1 g a ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> A &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>fn</keyword> r &#x21D2 <keyword>case</keyword> [ &#x22A2 A] <keyword>of</keyword> 
  | [ &#x22A2 <a href="#base">base</a>] &#x21D2 <keyword>let</keyword>  <a href="#RBase">RBase</a> s = r <keyword>in</keyword> s
  | [ &#x22A2 <a href="#arr">arr</a> A B] &#x21D2
    <keyword>let</keyword> rv =
    cr3 [g, x : <a href="#tm">tm</a> A[]] [ &#x22A2 A] [g, x : <a href="#tm">tm</a> A[] &#x22A2 x] (<a href="&sigma;Var">SVar</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 x]) <keyword>in</keyword>
    <keyword>let</keyword>  <a href="#RArr">RArr</a> r' = r <keyword>in</keyword> 
    <keyword>let</keyword> s =
    <a href="#cr1">cr1</a> [g, x : <a href="#tm">tm</a> A[]] [ &#x22A2 B] [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#app">app</a> M[&hellip;] x] (r' [g, x : <a href="#tm">tm</a> A[]] [g, x : <a href="#tm">tm</a> A[] &#x22A2 &hellip;] [g, x : <a href="#tm">tm</a> A[] &#x22A2 x] rv) <keyword>in</keyword>
    <keyword>let</keyword> sm = <a href="#ext_SN">ext_SN</a> [g, x : <a href="#tm">tm</a> A[] &#x22A2 M[&hellip;]] [g, x : <a href="#tm">tm</a> A[] &#x22A2 x] s <keyword>in</keyword>
    <a href="#anti_renameSN">anti_renameSN</a> [_] [_] [g, x : <a href="#tm">tm</a> A[] &#x22A2 &hellip;] [g &#x22A2 M] sm
  | [ &#x22A2 <a href="#sum">sum</a> A B] &#x21D2 <keyword>let</keyword>  <a href="#RSum">RSum</a> d = r <keyword>in</keyword> ds_cr1 [_] [ &#x22A2 _] [ &#x22A2 _] [_ &#x22A2 _] d
<keyword>and</keyword> <span class="function" id="ds_cr1">ds_cr1</span> : {g : <a href="#cxt">cxt</a>} {A : [ &#x22A2 <a href="#ty">ty</a>]} {B : [ &#x22A2 <a href="#ty">ty</a>]} {M : [g &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} <a href="#DSClosure">DSClosure</a> [g &#x22A2 M] &#x2192 <a href="&sigma;N">SN</a> [g &#x22A2 M] / total d ( ds_cr1 g a b m d ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> A &#x21D2 <keyword>mlam</keyword> B &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>fn</keyword> d &#x21D2 <keyword>case</keyword> d <keyword>of</keyword> 
  | <a href="#DSLeft">DSLeft</a> r' (<a href="#Refl">Refl</a> )  &#x21D2 <a href="&sigma;Inl">SInl</a> (<a href="#cr1">cr1</a> [_] [ &#x22A2 _] [_ &#x22A2 _] r')
  | <a href="#DSRight">DSRight</a> r' (<a href="#Refl">Refl</a> )  &#x21D2 <a href="&sigma;Inr">SInr</a> (<a href="#cr1">cr1</a> [_] [ &#x22A2 _] [_ &#x22A2 _] r')
  | <a href="#DSSNe">DSSNe</a> sne  &#x21D2 <a href="&sigma;Neu">SNeu</a> sne
  | <a href="#DSRed">DSRed</a> d' r'  &#x21D2
    <keyword>let</keyword> sn = <a href="#ds_cr1">ds_cr1</a> [_] [ &#x22A2 _] [ &#x22A2 _] [_ &#x22A2 _] d' <keyword>in</keyword> <a href="&sigma;Red">SRed</a> r' sn
<keyword>and</keyword> <span class="function" id="cr2">cr2</span> : {g : <a href="#cxt">cxt</a>} {A : [ &#x22A2 <a href="#ty">ty</a>]} {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} {M' : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;NRed">SNRed</a> [g &#x22A2 M] [g &#x22A2 M'] &#x2192 <a href="#Red">Red</a> [ &#x22A2 A] [g &#x22A2 M'] &#x2192 <a href="#Red">Red</a> [ &#x22A2 A] [g &#x22A2 M] / total a ( cr2 g a ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> A &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> M' &#x21D2 <keyword>fn</keyword> sr &#x21D2 <keyword>fn</keyword> rm' &#x21D2 <keyword>case</keyword> [ &#x22A2 A] <keyword>of</keyword> 
  | [ &#x22A2 <a href="#base">base</a>] &#x21D2 <keyword>let</keyword>  <a href="#RBase">RBase</a> sm' = rm' <keyword>in</keyword> <a href="#RBase">RBase</a> (<a href="&sigma;Red">SRed</a> sr sm')
  | [ &#x22A2 <a href="#arr">arr</a> A B] &#x21D2
    <keyword>let</keyword>  <a href="#RArr">RArr</a> rm' = rm' <keyword>in</keyword> <a href="#RArr">RArr</a> (<keyword>mlam</keyword> g' &#x21D2 <keyword>mlam</keyword> R &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>fn</keyword> rn &#x21D2 <a href="#cr2">cr2</a> [g'] [ &#x22A2 B] [g' &#x22A2 <a href="#app">app</a> M[#R] N] [g' &#x22A2 <a href="#app">app</a> M'[#R] N] (<a href="&sigma;Appl">SAppl</a> (<a href="#renameSNRed">renameSNRed</a> [g' &#x22A2 #R] [g &#x22A2 M] sr)) (rm' [g'] [g' &#x22A2 #R] [g' &#x22A2 N] rn))
  | [ &#x22A2 <a href="#sum">sum</a> A B] &#x21D2 <keyword>let</keyword>  <a href="#RSum">RSum</a> d = rm' <keyword>in</keyword> <a href="#RSum">RSum</a> (<a href="#DSRed">DSRed</a> d sr)
<keyword>and</keyword> <span class="function" id="cr3">cr3</span> : {g : <a href="#cxt">cxt</a>} {A : [ &#x22A2 <a href="#ty">ty</a>]} {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;Ne">SNe</a> [g &#x22A2 M] &#x2192 <a href="#Red">Red</a> [ &#x22A2 A] [g &#x22A2 M] / total a ( cr3 g a ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> A &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>fn</keyword> sm &#x21D2 <keyword>case</keyword> [ &#x22A2 A] <keyword>of</keyword> 
  | [ &#x22A2 <a href="#base">base</a>] &#x21D2 <a href="#RBase">RBase</a> (<a href="&sigma;Neu">SNeu</a> sm)
  | [ &#x22A2 <a href="#arr">arr</a> A B] &#x21D2
    <a href="#RArr">RArr</a> (<keyword>mlam</keyword> g' &#x21D2 <keyword>mlam</keyword> R &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>fn</keyword> rn &#x21D2 
    <keyword>let</keyword> sn = <a href="#cr1">cr1</a> [g'] [ &#x22A2 A] [g' &#x22A2 N] rn <keyword>in</keyword>
    <a href="#cr3">cr3</a> [g'] [ &#x22A2 B] [g' &#x22A2 <a href="#app">app</a> M[#R] N] (<a href="&sigma;App">SApp</a> (<a href="#renameSNe">renameSNe</a> [g' &#x22A2 #R] [g &#x22A2 M] sm) sn))
  | [ &#x22A2 <a href="#sum">sum</a> A B] &#x21D2 <a href="#RSum">RSum</a> (<a href="#DSSNe">DSSNe</a> sm);
<br><keyword>rec</keyword> <span class="function" id="red_var">red_var</span> : {g : <a href="#cxt">cxt</a>} {#p : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="#Red">Red</a> [ &#x22A2 A] [g &#x22A2 #p] / total  ( red_var ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> p &#x21D2 <a href="#cr3">cr3</a> [_] [ &#x22A2 _] [_ &#x22A2 _] (<a href="&sigma;Var">SVar</a> [g &#x22A2 #p]);
<br><keyword>rec</keyword> <span class="function" id="fundVar">fundVar</span> : {g : <a href="#cxt">cxt</a>} {#p : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="#RedS">RedS</a> [g] [g' &#x22A2 &sigma;] &#x2192 <a href="#Red">Red</a> [ &#x22A2 A] [g' &#x22A2 #p[&sigma;]] / total g ( fundVar g ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> p &#x21D2 <keyword>fn</keyword> s &#x21D2 <keyword>case</keyword> [g] <keyword>of</keyword> 
  | [] &#x21D2 <keyword>impossible</keyword> [ &#x22A2 #p]
  | [g, x : <a href="#tm">tm</a> A[]] &#x21D2
    <keyword>case</keyword> [g, x : <a href="#tm">tm</a> _ &#x22A2 #p] <keyword>of</keyword> 
    | [g, x : <a href="#tm">tm</a> A[] &#x22A2 x] &#x21D2 <keyword>let</keyword>  <a href="#RCons">RCons</a> r s' = s <keyword>in</keyword> r
    | [g, x : <a href="#tm">tm</a> A[] &#x22A2 #q[&hellip;]] &#x21D2
      <keyword>let</keyword>  <a href="#RCons">RCons</a> r s' = s <keyword>in</keyword> <a href="#fundVar">fundVar</a> [g] [g &#x22A2 #q] s';
<br><keyword>rec</keyword> <span class="function" id="eq_red">eq_red</span> : <a href="#Eq">Eq</a> [g &#x22A2 M] [g &#x22A2 N] &#x2192 <a href="#Red">Red</a> [ &#x22A2 C] [g &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)] &#x2192 <a href="#Red">Red</a> [ &#x22A2 C] [g &#x22A2 <a href="#match">match</a> N (&lambda;x. N1) (&lambda;y. N2)] / total  ( eq_red ) / =
<keyword>fn</keyword> e &#x21D2 <keyword>fn</keyword> r &#x21D2 <keyword>let</keyword>  <a href="#Refl">Refl</a> = e <keyword>in</keyword> r;
<br><keyword>rec</keyword> <span class="function" id="fundamental_lemma">fundamental_lemma</span> : {g : <a href="#cxt">cxt</a>} {g' : <a href="#cxt">cxt</a>} {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} [g' &#x22A2 g] <a href="#RedS">RedS</a> [g] [g' &#x22A2 &sigma;] &#x2192 <a href="#Red">Red</a> [ &#x22A2 A[]] [g' &#x22A2 M[&sigma;]] / total m ( fundamental_lemma g g' a m ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> g' &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> S &#x21D2 <keyword>fn</keyword> rs &#x21D2 <keyword>case</keyword> [g &#x22A2 M] <keyword>of</keyword> 
  | [g &#x22A2 #p] &#x21D2 <a href="#fundVar">fundVar</a> [g] [g &#x22A2 #p] rs
  | [g &#x22A2 <a href="#app">app</a> M N] &#x21D2
    <keyword>let</keyword>  <a href="#RArr">RArr</a> r1 = <a href="#fundamental_lemma">fundamental_lemma</a> [g] [g'] [g &#x22A2 M] [g' &#x22A2 &sigma;] rs <keyword>in</keyword> 
    <keyword>let</keyword> r2 = <a href="#fundamental_lemma">fundamental_lemma</a> [g] [g'] [g &#x22A2 N] [g' &#x22A2 &sigma;] rs <keyword>in</keyword> r1 [g'] [g' &#x22A2 &hellip;] [g' &#x22A2 N[&sigma;]] r2
  | [g &#x22A2 <a href="#abs">abs</a> (&lambda;x. M)] &#x21D2
    <a href="#RArr">RArr</a> (<keyword>mlam</keyword> g'' &#x21D2 <keyword>mlam</keyword> R &#x21D2 <keyword>mlam</keyword> N &#x21D2 <keyword>fn</keyword> rn &#x21D2 
    <keyword>let</keyword> rs' = <a href="#rename_redS">rename_redS</a> [g'] [g''] [g'' &#x22A2 #R] rs <keyword>in</keyword>
    <keyword>let</keyword> r =
    <a href="#fundamental_lemma">fundamental_lemma</a> [g, x : <a href="#tm">tm</a> _] [g''] [g, x : <a href="#tm">tm</a> _ &#x22A2 M] [g'' &#x22A2 &sigma;[#R], N] (<a href="#RCons">RCons</a> rn rs') <keyword>in</keyword>
    <keyword>let</keyword> sn = <a href="#cr1">cr1</a> [_] [ &#x22A2 _] [_ &#x22A2 _] rn <keyword>in</keyword>
    <keyword>let</keyword> sn' = <a href="&sigma;Beta">SBeta</a> [g'', x : <a href="#tm">tm</a> _ &#x22A2 M[&sigma;[#R[&hellip;]], x]] sn <keyword>in</keyword>
    <a href="#cr2">cr2</a> [_] [ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] sn' r)
  | [g &#x22A2 <a href="#inl">inl</a> B[] M] &#x21D2
    <keyword>let</keyword> r = <a href="#fundamental_lemma">fundamental_lemma</a> [g] [g'] [g &#x22A2 M] [g' &#x22A2 &sigma;] rs <keyword>in</keyword>
    <a href="#RSum">RSum</a> (<a href="#DSLeft">DSLeft</a> r <a href="#Refl">Refl</a>)
  | [g &#x22A2 <a href="#inr">inr</a> A[] M] &#x21D2
    <keyword>let</keyword> r = <a href="#fundamental_lemma">fundamental_lemma</a> [g] [g'] [g &#x22A2 M] [g' &#x22A2 &sigma;] rs <keyword>in</keyword>
    <a href="#RSum">RSum</a> (<a href="#DSRight">DSRight</a> r <a href="#Refl">Refl</a>)
  | [g &#x22A2 <a href="#match">match</a> M (&lambda;x. N1) (&lambda;y. N2)] &#x21D2
    <keyword>let</keyword> r = <a href="#fundamental_lemma">fundamental_lemma</a> [g] [g'] [g &#x22A2 M] [g' &#x22A2 &sigma;] rs <keyword>in</keyword>
    <keyword>let</keyword>  <a href="#RSum">RSum</a> d = r <keyword>in</keyword> main_ds [g] [g'] [g' &#x22A2 M[&sigma;]] [g, x : <a href="#tm">tm</a> _ &#x22A2 N1] [g, y : <a href="#tm">tm</a> _ &#x22A2 N2] [g' &#x22A2 &sigma;] rs d
<keyword>and</keyword> <span class="function" id="main_ds">main_ds</span> : {g : <a href="#cxt">cxt</a>} {g' : <a href="#cxt">cxt</a>} {M : [g' &#x22A2 <a href="#tm">tm</a> (<a href="#sum">sum</a> A[] B[])]} {N1 : [g, x : <a href="#tm">tm</a> A[] &#x22A2 <a href="#tm">tm</a> C[]]} {N2 : [g, y : <a href="#tm">tm</a> B[] &#x22A2 <a href="#tm">tm</a> C[]]} [g' &#x22A2 g] <a href="#RedS">RedS</a> [g] [g' &#x22A2 &sigma;] &#x2192 <a href="#DSClosure">DSClosure</a> [g' &#x22A2 M] &#x2192 <a href="#Red">Red</a> [ &#x22A2 C[]] [g' &#x22A2 <a href="#match">match</a> M (&lambda;x. N1[&sigma;[&hellip;], x]) (&lambda;y. N2[&sigma;[&hellip;], y])] / total d ( main_ds g g' m n1 n2 s rs d ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> g' &#x21D2 <keyword>mlam</keyword> M &#x21D2 <keyword>mlam</keyword> N1 &#x21D2 <keyword>mlam</keyword> N2 &#x21D2 <keyword>mlam</keyword> S &#x21D2 <keyword>fn</keyword> rs &#x21D2 <keyword>fn</keyword> d &#x21D2 <keyword>case</keyword> d <keyword>of</keyword> 
  | <a href="#DSLeft">DSLeft</a> r e  &#x21D2
    <keyword>let</keyword> sn0 = <a href="#cr1">cr1</a> [_] [ &#x22A2 _] [_ &#x22A2 _] r <keyword>in</keyword>
    <keyword>let</keyword> r1 =
    <a href="#fundamental_lemma">fundamental_lemma</a> [_, x : <a href="#tm">tm</a> _] [_] [_, x : <a href="#tm">tm</a> _ &#x22A2 N1] [_ &#x22A2 &sigma;[&hellip;], _] (<a href="#RCons">RCons</a> r rs) <keyword>in</keyword>
    <keyword>let</keyword> r2 =
    <a href="#fundamental_lemma">fundamental_lemma</a> [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _ &#x22A2 N2] [_ &#x22A2 &sigma;[&hellip;], _] (<a href="#RCons">RCons</a> (<a href="#red_var">red_var</a> [g', y : <a href="#tm">tm</a> _] [g', y : <a href="#tm">tm</a> _ &#x22A2 y]) (<a href="#rename_redS">rename_redS</a> [g'] [g', y : <a href="#tm">tm</a> _] [g', y : <a href="#tm">tm</a> _ &#x22A2 &hellip;] rs)) <keyword>in</keyword>
    <keyword>let</keyword> r1' =
    <a href="#fundamental_lemma">fundamental_lemma</a> [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _ &#x22A2 N1] [_ &#x22A2 &sigma;[&hellip;], _] (<a href="#RCons">RCons</a> (<a href="#red_var">red_var</a> [g', x : <a href="#tm">tm</a> _] [g', x : <a href="#tm">tm</a> _ &#x22A2 x]) (<a href="#rename_redS">rename_redS</a> [g'] [g', x : <a href="#tm">tm</a> _] [g', x : <a href="#tm">tm</a> _ &#x22A2 &hellip;] rs)) <keyword>in</keyword>
    <keyword>let</keyword> sn1 = <a href="#cr1">cr1</a> [_] [ &#x22A2 _] [_ &#x22A2 _] r1' <keyword>in</keyword>
    <keyword>let</keyword> sn2 = <a href="#cr1">cr1</a> [_] [ &#x22A2 _] [_ &#x22A2 _] r2 <keyword>in</keyword>
    <keyword>let</keyword> snr = <a href="&sigma;CInl">SCInl</a> sn0 sn1 sn2 <keyword>in</keyword>
    <a href="#eq_red">eq_red</a> e (<a href="#cr2">cr2</a> [_] [ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] snr r1)
  | <a href="#DSRight">DSRight</a> r e  &#x21D2
    <keyword>let</keyword> sn0 = <a href="#cr1">cr1</a> [_] [ &#x22A2 _] [_ &#x22A2 _] r <keyword>in</keyword>
    <keyword>let</keyword> r1 =
    <a href="#fundamental_lemma">fundamental_lemma</a> [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _ &#x22A2 N1] [_ &#x22A2 &sigma;[&hellip;], _] (<a href="#RCons">RCons</a> (<a href="#red_var">red_var</a> [g', x : <a href="#tm">tm</a> _] [g', x : <a href="#tm">tm</a> _ &#x22A2 x]) (<a href="#rename_redS">rename_redS</a> [g'] [g', x : <a href="#tm">tm</a> _] [g', x : <a href="#tm">tm</a> _ &#x22A2 &hellip;] rs)) <keyword>in</keyword>
    <keyword>let</keyword> r2 =
    <a href="#fundamental_lemma">fundamental_lemma</a> [_, y : <a href="#tm">tm</a> _] [_] [_, y : <a href="#tm">tm</a> _ &#x22A2 N2] [_ &#x22A2 &sigma;[&hellip;], _] (<a href="#RCons">RCons</a> r rs) <keyword>in</keyword>
    <keyword>let</keyword> r2' =
    <a href="#fundamental_lemma">fundamental_lemma</a> [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _ &#x22A2 N2] [_ &#x22A2 &sigma;[&hellip;], _] (<a href="#RCons">RCons</a> (<a href="#red_var">red_var</a> [g', y : <a href="#tm">tm</a> _] [g', y : <a href="#tm">tm</a> _ &#x22A2 y]) (<a href="#rename_redS">rename_redS</a> [g'] [g', y : <a href="#tm">tm</a> _] [g', y : <a href="#tm">tm</a> _ &#x22A2 &hellip;] rs)) <keyword>in</keyword>
    <keyword>let</keyword> sn1 = <a href="#cr1">cr1</a> [_] [ &#x22A2 _] [_ &#x22A2 _] r1 <keyword>in</keyword>
    <keyword>let</keyword> sn2 = <a href="#cr1">cr1</a> [_] [ &#x22A2 _] [_ &#x22A2 _] r2' <keyword>in</keyword>
    <keyword>let</keyword> snr = <a href="&sigma;CInr">SCInr</a> sn0 sn1 sn2 <keyword>in</keyword>
    <a href="#eq_red">eq_red</a> e (<a href="#cr2">cr2</a> [_] [ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] snr r2)
  | <a href="#DSSNe">DSSNe</a> sne  &#x21D2
    <keyword>let</keyword> r1 =
    <a href="#fundamental_lemma">fundamental_lemma</a> [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _] [_, x : <a href="#tm">tm</a> _ &#x22A2 N1] [_ &#x22A2 &sigma;[&hellip;], _] (<a href="#RCons">RCons</a> (<a href="#red_var">red_var</a> [g', x : <a href="#tm">tm</a> _] [g', x : <a href="#tm">tm</a> _ &#x22A2 x]) (<a href="#rename_redS">rename_redS</a> [g'] [g', x : <a href="#tm">tm</a> _] [g', x : <a href="#tm">tm</a> _ &#x22A2 &hellip;] rs)) <keyword>in</keyword>
    <keyword>let</keyword> r2 =
    <a href="#fundamental_lemma">fundamental_lemma</a> [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _] [_, y : <a href="#tm">tm</a> _ &#x22A2 N2] [_ &#x22A2 &sigma;[&hellip;], _] (<a href="#RCons">RCons</a> (<a href="#red_var">red_var</a> [g', y : <a href="#tm">tm</a> _] [g', y : <a href="#tm">tm</a> _ &#x22A2 y]) (<a href="#rename_redS">rename_redS</a> [g'] [g', y : <a href="#tm">tm</a> _] [g', y : <a href="#tm">tm</a> _ &#x22A2 &hellip;] rs)) <keyword>in</keyword>
    <keyword>let</keyword> sn1 = <a href="#cr1">cr1</a> [_] [ &#x22A2 _] [_ &#x22A2 _] r1 <keyword>in</keyword>
    <keyword>let</keyword> sn2 = <a href="#cr1">cr1</a> [_] [ &#x22A2 _] [_ &#x22A2 _] r2 <keyword>in</keyword>
    <keyword>let</keyword> sne' = <a href="&sigma;Case">SCase</a> sne sn1 sn2 <keyword>in</keyword> <a href="#cr3">cr3</a> [_] [ &#x22A2 _] [_ &#x22A2 _] sne'
  | <a href="#DSRed">DSRed</a> d' r  &#x21D2
    <keyword>let</keyword>  r : <a href="&sigma;NRed">SNRed</a> [_ &#x22A2 _] [g' &#x22A2 M']= r <keyword>in</keyword> 
    <keyword>let</keyword> r' =
    <a href="#main_ds">main_ds</a> [g] [g'] [g' &#x22A2 M'] [g, x : <a href="#tm">tm</a> _ &#x22A2 N1] [g, y : <a href="#tm">tm</a> _ &#x22A2 N2] [_ &#x22A2 &sigma;] rs d' <keyword>in</keyword>
    <keyword>let</keyword> snr =
    <a href="&sigma;RCase">SRCase</a> r [g', x : <a href="#tm">tm</a> _ &#x22A2 N1[&sigma;[&hellip;], x]] [g', y : <a href="#tm">tm</a> _ &#x22A2 N2[&sigma;[&hellip;], y]] <keyword>in</keyword>
    <a href="#cr2">cr2</a> [_] [ &#x22A2 _] [_ &#x22A2 _] [_ &#x22A2 _] snr r';
<br><keyword>rec</keyword> <span class="function" id="id_red">id_red</span> : {g : <a href="#cxt">cxt</a>} <a href="#RedS">RedS</a> [g] [g &#x22A2 &hellip;] / total g ( id_red g ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>case</keyword> [g] <keyword>of</keyword> 
  | [] &#x21D2 <a href="#RNil">RNil</a>
  | [g, x : <a href="#tm">tm</a> A[]] &#x21D2
    <keyword>let</keyword> r = <a href="#id_red">id_red</a> [g] <keyword>in</keyword>
    <keyword>let</keyword> r' = <a href="#rename_redS">rename_redS</a> [g] [g, x : <a href="#tm">tm</a> A[]] [g, x : <a href="#tm">tm</a> A[] &#x22A2 &hellip;] r <keyword>in</keyword>
    <a href="#RCons">RCons</a> (<a href="#red_var">red_var</a> [g, x : <a href="#tm">tm</a> A[]] [g, x : <a href="#tm">tm</a> A[] &#x22A2 x]) r';
<br><keyword>rec</keyword> <span class="function" id="norm">norm</span> : {g : <a href="#cxt">cxt</a>} {M : [g &#x22A2 <a href="#tm">tm</a> A[]]} <a href="&sigma;N">SN</a> [g &#x22A2 M] / total  ( norm ) / =
<keyword>mlam</keyword> g &#x21D2 <keyword>mlam</keyword> M &#x21D2 <a href="#cr1">cr1</a> [_] [ &#x22A2 _] [_ &#x22A2 _] (<a href="#fundamental_lemma">fundamental_lemma</a> [g] [g] [g &#x22A2 M] [g &#x22A2 &hellip;] (<a href="#id_red">id_red</a> [g]));
</code></pre><br><br><h3>To download the code: <a href="sn.bel" target="_blank">sn.bel</a></h3>

</body>
</html>
